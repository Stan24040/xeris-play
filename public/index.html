<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>XERIS.PLAY ‚Äî On-Chain Casino | Play with XRS</title>
<meta name="description" content="The premier on-chain casino built on the Xeris blockchain. Play Crash, Dice, Roulette and Blackjack with real XRS. 0% house edge. Instant withdrawals."/>
<meta name="keywords" content="xeris, xrs, blockchain casino, crypto casino, crash game, dice, roulette, blackjack, defi gaming"/>
<meta name="theme-color" content="#c8ff00"/>
<meta name="robots" content="index, follow"/>
<link rel="canonical" href="https://xeris.play"/>

<!-- Open Graph -->
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://xeris.play"/>
<meta property="og:title" content="XERIS.PLAY ‚Äî On-Chain Casino"/>
<meta property="og:description" content="4 provably fair casino games powered by the Xeris blockchain. 0% house edge. Instant XRS withdrawals."/>
<meta property="og:image" content="/icon-512.png"/>

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="XERIS.PLAY ‚Äî On-Chain Casino"/>
<meta name="twitter:description" content="Crash ¬∑ Dice ¬∑ Roulette ¬∑ Blackjack. Powered by Xeris Blockchain."/>
<meta name="twitter:image" content="/icon-512.png"/>

<!-- PWA -->
<link rel="manifest" href="/manifest.json"/>
<link rel="icon" type="image/svg+xml" href="/icon.svg"/>
<link rel="icon" type="image/x-icon" href="/favicon.ico"/>
<link rel="apple-touch-icon" href="/icon-192.png"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="XERIS.PLAY"/>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#04060f;--s1:#080d1c;--s2:#0d1428;--br:#1a2540;
  --blue:#00d4ff;--green:#00ff88;--pink:#ff2d78;--yellow:#ffd700;--purple:#b84dff;
  --text:#e0eaff;--dim:#4a6080;--xrs:#c8ff00;--xrs2:#a0d400;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Rajdhani',sans-serif;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:linear-gradient(rgba(200,255,0,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(200,255,0,.025) 1px,transparent 1px);
  background-size:44px 44px}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.05) 2px,rgba(0,0,0,.05) 4px)}
.glow-orb{position:fixed;top:-200px;left:50%;transform:translateX(-50%);width:800px;height:400px;border-radius:50%;
  background:radial-gradient(ellipse,rgba(200,255,0,.06) 0%,transparent 70%);pointer-events:none;z-index:0}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header{position:sticky;top:0;z-index:90;display:flex;align-items:center;justify-content:space-between;
  padding:14px 32px;border-bottom:1px solid var(--br);background:rgba(4,6,15,.93);backdrop-filter:blur(20px)}
.logo{font-family:'Orbitron',sans-serif;font-weight:900;font-size:1.4rem;letter-spacing:.08em;
  color:var(--xrs);text-shadow:0 0 24px rgba(200,255,0,.4);text-decoration:none;cursor:pointer}
.logo b{color:var(--blue)}
.hdr-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.bal-bar{display:flex;align-items:center;gap:10px;background:var(--s2);border:1px solid var(--br);
  border-radius:10px;padding:8px 16px}
.bal-label{font-size:.65rem;color:var(--dim);letter-spacing:.12em;text-transform:uppercase}
#balDisp{font-family:'Orbitron',sans-serif;font-size:.95rem;font-weight:700;color:var(--yellow);transition:color .4s}
.hdr-user-btn{display:flex;align-items:center;gap:8px;background:rgba(200,255,0,.07);
  border:1px solid rgba(200,255,0,.3);border-radius:10px;padding:8px 16px;color:var(--xrs);
  font-family:'Rajdhani',sans-serif;font-weight:700;font-size:.85rem;cursor:pointer;
  letter-spacing:.04em;transition:border-color .2s,box-shadow .2s;white-space:nowrap}
.hdr-user-btn:hover{box-shadow:0 0 14px rgba(200,255,0,.2)}
.hdr-dot{width:8px;height:8px;border-radius:50%;background:var(--xrs);box-shadow:0 0 6px var(--xrs);flex-shrink:0}
.hdr-login-btn{background:linear-gradient(135deg,var(--xrs),var(--xrs2));border:none;border-radius:10px;
  padding:9px 20px;color:#070c00;font-family:'Orbitron',sans-serif;font-weight:700;font-size:.76rem;
  cursor:pointer;letter-spacing:.05em;transition:box-shadow .2s}
.hdr-login-btn:hover{box-shadow:0 0 18px rgba(200,255,0,.4)}

/* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.84);backdrop-filter:blur(8px);z-index:1000;
  display:none;align-items:center;justify-content:center;padding:16px;overflow-y:auto}
.overlay.open{display:flex}
.modal{background:var(--s1);border:1px solid var(--br);border-radius:18px;width:min(480px,100%);
  animation:mIn .26s cubic-bezier(.34,1.56,.64,1);max-height:calc(100vh - 32px);
  overflow-y:auto;display:flex;flex-direction:column}
@keyframes mIn{from{opacity:0;transform:scale(.9) translateY(24px)}to{opacity:1;transform:none}}
.modal-head{padding:20px 24px 16px;border-bottom:1px solid var(--br);display:flex;align-items:center;justify-content:space-between}
.modal-title{font-family:'Orbitron',sans-serif;font-size:.92rem;font-weight:700;color:var(--xrs)}
.modal-close{background:none;border:1px solid var(--br);border-radius:7px;color:var(--dim);width:30px;height:30px;
  cursor:pointer;font-size:.9rem;display:flex;align-items:center;justify-content:center;transition:border-color .2s,color .2s}
.modal-close:hover{border-color:var(--pink);color:var(--pink)}
.modal-body{padding:22px 24px 26px}

/* ‚îÄ‚îÄ AUTH MODAL ‚îÄ‚îÄ */
.auth-tabs{display:flex;gap:0;background:var(--s2);border:1px solid var(--br);border-radius:9px;
  padding:3px;margin-bottom:22px}
.auth-tab{flex:1;padding:8px;text-align:center;border-radius:7px;cursor:pointer;font-family:'Orbitron',sans-serif;
  font-size:.72rem;font-weight:700;letter-spacing:.06em;color:var(--dim);transition:background .2s,color .2s}
.auth-tab.active{background:linear-gradient(135deg,var(--xrs),var(--xrs2));color:#070c00}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;color:var(--dim);margin-bottom:6px}
.form-input{width:100%;background:var(--bg);border:1px solid var(--br);color:var(--text);
  font-family:'Rajdhani',sans-serif;font-size:.95rem;padding:11px 14px;border-radius:8px;outline:none;
  transition:border-color .2s;letter-spacing:.02em}
.form-input:focus{border-color:var(--xrs)}
.form-input::placeholder{color:var(--dim)}
.form-error{font-size:.74rem;color:var(--pink);min-height:14px;margin-top:6px;letter-spacing:.02em}
.form-submit{width:100%;padding:12px;background:linear-gradient(135deg,var(--xrs),var(--xrs2));border:none;
  border-radius:9px;color:#070c00;font-family:'Orbitron',sans-serif;font-size:.78rem;font-weight:700;
  letter-spacing:.05em;cursor:pointer;transition:box-shadow .2s;margin-top:4px}
.form-submit:hover{box-shadow:0 0 22px rgba(200,255,0,.4)}
.form-submit:disabled{opacity:.5;cursor:not-allowed;box-shadow:none}
.form-divider{text-align:center;color:var(--dim);font-size:.76rem;margin:16px 0}

/* ‚îÄ‚îÄ DASHBOARD MODAL ‚îÄ‚îÄ */
.dash-modal{width:min(560px,100%)}
.dash-header{display:flex;align-items:center;gap:14px;padding:22px 24px 18px;border-bottom:1px solid var(--br);
  background:linear-gradient(135deg,rgba(200,255,0,.04),transparent)}
.dash-avatar{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,var(--xrs),var(--xrs2));
  display:flex;align-items:center;justify-content:center;font-family:'Orbitron',sans-serif;font-size:1.3rem;
  font-weight:900;color:#070c00;flex-shrink:0}
.dash-name{font-family:'Orbitron',sans-serif;font-size:1rem;font-weight:700;color:var(--text)}
.dash-since{font-size:.74rem;color:var(--dim);margin-top:2px}
.dash-body{padding:20px 24px 24px}
.dash-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
.dstat{background:var(--s2);border:1px solid var(--br);border-radius:10px;padding:13px;text-align:center}
.dstat-lbl{font-size:.62rem;letter-spacing:.1em;text-transform:uppercase;color:var(--dim);margin-bottom:5px}
.dstat-val{font-family:'Orbitron',sans-serif;font-size:.88rem;font-weight:700}
.dash-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px}
.dash-action-btn{padding:11px;border-radius:9px;border:1px solid;font-family:'Orbitron',sans-serif;
  font-size:.72rem;font-weight:700;letter-spacing:.04em;cursor:pointer;transition:all .18s;display:flex;
  align-items:center;justify-content:center;gap:8px}
.btn-deposit{border-color:var(--green);color:var(--green);background:rgba(0,255,136,.06)}
.btn-deposit:hover{background:var(--green);color:#000}
.btn-withdraw{border-color:var(--yellow);color:var(--yellow);background:rgba(255,215,0,.06)}
.btn-withdraw:hover{background:var(--yellow);color:#000}
.btn-faucet{border-color:var(--blue);color:var(--blue);background:rgba(0,212,255,.06)}
.btn-faucet:hover{background:var(--blue);color:#000}
.btn-logout{border-color:var(--pink);color:var(--pink);background:rgba(255,45,120,.06)}
.btn-logout:hover{background:var(--pink);color:#fff}

/* ‚îÄ‚îÄ TRANSACTION HISTORY ‚îÄ‚îÄ */
.tx-section-title{font-size:.64rem;letter-spacing:.14em;text-transform:uppercase;color:var(--dim);
  margin-bottom:10px;display:flex;align-items:center;gap:10px}
.tx-section-title::after{content:'';flex:1;height:1px;background:var(--br)}
.tx-list{display:flex;flex-direction:column;gap:6px;max-height:180px;overflow-y:auto}
.tx-list::-webkit-scrollbar{width:3px}
.tx-list::-webkit-scrollbar-track{background:transparent}
.tx-list::-webkit-scrollbar-thumb{background:var(--br);border-radius:3px}
.tx-row{display:flex;align-items:center;gap:10px;padding:9px 12px;background:var(--s2);
  border:1px solid var(--br);border-radius:8px;font-size:.8rem}
.tx-icon{font-size:1rem;flex-shrink:0;width:24px;text-align:center}
.tx-info{flex:1}
.tx-type{font-family:'Orbitron',sans-serif;font-size:.68rem;font-weight:700;color:var(--text)}
.tx-time{font-size:.66rem;color:var(--dim);margin-top:1px}
.tx-amt{font-family:'Orbitron',sans-serif;font-size:.76rem;font-weight:700}
.tx-amt.pos{color:var(--green)}
.tx-amt.neg{color:var(--pink)}
.tx-amt.neu{color:var(--dim)}
.tx-empty{text-align:center;color:var(--dim);font-size:.78rem;padding:16px 0}

/* ‚îÄ‚îÄ DEPOSIT/WITHDRAW PANEL ‚îÄ‚îÄ */
.txn-panel{display:none}
.txn-panel.show{display:block}
.txn-back{background:none;border:none;color:var(--dim);font-family:'Rajdhani',sans-serif;font-size:.82rem;
  cursor:pointer;display:flex;align-items:center;gap:6px;margin-bottom:16px;padding:0;transition:color .2s}
.txn-back:hover{color:var(--text)}
.txn-address-info{background:var(--s2);border:1px solid var(--br);border-radius:9px;padding:13px;
  margin-bottom:16px;font-size:.78rem;color:var(--dim);line-height:1.6}
.txn-address-info b{font-family:'Orbitron',sans-serif;font-size:.72rem;color:var(--blue);word-break:break-all}
.xrs-quick-btns{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.xrs-quick{background:var(--s2);border:1px solid var(--br);border-radius:6px;color:var(--dim);
  padding:6px 12px;font-size:.74rem;cursor:pointer;font-family:'Orbitron',sans-serif;font-weight:700;
  transition:border-color .2s,color .2s}
.xrs-quick:hover{border-color:var(--xrs);color:var(--xrs)}
.pending-badge{display:inline-flex;align-items:center;gap:5px;background:rgba(255,215,0,.1);
  border:1px solid rgba(255,215,0,.25);border-radius:20px;padding:3px 10px;font-size:.68rem;
  color:var(--yellow);font-family:'Orbitron',sans-serif;letter-spacing:.06em}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.pending-badge span{animation:pulse 1.5s infinite}

/* ‚îÄ‚îÄ MAIN / GAME SECTION ‚îÄ‚îÄ */
main{position:relative;z-index:5;padding:24px 32px;display:none}
main.visible{display:block}
.sec-title{font-family:'Orbitron',sans-serif;font-size:.63rem;font-weight:700;letter-spacing:.22em;
  text-transform:uppercase;color:var(--dim);margin-bottom:16px;display:flex;align-items:center;gap:12px}
.sec-title::after{content:'';flex:1;height:1px;background:var(--br)}
.game-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;margin-bottom:32px}
.gcard{background:var(--s1);border:1px solid var(--br);border-radius:14px;overflow:hidden;cursor:pointer;
  transition:transform .2s,border-color .2s,box-shadow .2s}
.gcard:hover{transform:translateY(-4px);box-shadow:0 8px 36px rgba(0,0,0,.5)}
.gcard.active{border-color:var(--ac)!important;box-shadow:0 0 24px rgba(0,0,0,.4)!important}
.ch{padding:16px 20px 0;display:flex;align-items:center;justify-content:space-between}
.cicon{font-size:2rem}
.cbadge{font-size:.58rem;font-weight:700;letter-spacing:.08em;padding:3px 9px;border-radius:20px;
  background:rgba(255,255,255,.05);color:var(--ac);border:1px solid rgba(255,255,255,.1);text-transform:uppercase}
.cb{padding:12px 20px 20px}
.cname{font-family:'Orbitron',sans-serif;font-size:.95rem;font-weight:700;color:var(--text);margin-bottom:4px}
.cdesc{color:var(--dim);font-size:.82rem;line-height:1.5;margin-bottom:12px}
.cstats{display:flex;gap:14px;margin-bottom:12px}
.stat .sl{font-size:.58rem;letter-spacing:.1em;color:var(--dim);text-transform:uppercase;margin-bottom:2px}
.stat .sv{font-family:'Orbitron',sans-serif;font-size:.78rem;font-weight:700;color:var(--ac)}
.pbtn{width:100%;padding:10px;background:transparent;border:1px solid var(--ac);border-radius:8px;color:var(--ac);
  font-family:'Rajdhani',sans-serif;font-size:.9rem;font-weight:700;letter-spacing:.1em;
  text-transform:uppercase;cursor:pointer;transition:background .2s,color .2s}
.pbtn:hover{background:var(--ac);color:#000}

/* ‚îÄ‚îÄ ARENA ‚îÄ‚îÄ */
.arena{background:var(--s1);border:1px solid var(--br);border-radius:16px;overflow:hidden;display:none;margin-bottom:32px}
.arena.on{display:block}
.ah{padding:15px 26px;border-bottom:1px solid var(--br);display:flex;align-items:center;gap:12px}
.at{font-family:'Orbitron',sans-serif;font-size:.9rem;font-weight:700}
.acl{margin-left:auto;background:none;border:1px solid var(--br);border-radius:6px;color:var(--dim);
  padding:5px 12px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-weight:600;font-size:.78rem;
  transition:border-color .2s,color .2s}
.acl:hover{border-color:var(--pink);color:var(--pink)}
.ab{padding:22px}
.bet-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.blbl{color:var(--dim);font-size:.78rem;letter-spacing:.08em;text-transform:uppercase;min-width:36px}
.binput{background:var(--s2);border:1px solid var(--br);border-radius:7px;color:var(--text);
  font-family:'Orbitron',sans-serif;font-size:.83rem;padding:8px 10px;width:110px;outline:none;transition:border-color .2s}
.binput:focus{border-color:var(--xrs)}
.qbtn{background:var(--s2);border:1px solid var(--br);border-radius:6px;color:var(--dim);padding:7px 10px;
  font-size:.74rem;cursor:pointer;font-family:'Rajdhani',sans-serif;font-weight:600;transition:border-color .2s,color .2s}
.qbtn:hover{border-color:var(--xrs);color:var(--xrs)}
.abtn{padding:9px 22px;background:linear-gradient(135deg,var(--xrs),var(--xrs2));border:none;border-radius:8px;
  color:#070c00;font-family:'Orbitron',sans-serif;font-size:.72rem;font-weight:700;letter-spacing:.04em;
  text-transform:uppercase;cursor:pointer;margin-left:auto;transition:box-shadow .2s,transform .1s,opacity .2s}
.abtn:hover:not(:disabled){box-shadow:0 0 22px rgba(200,255,0,.4);transform:translateY(-1px)}
.abtn:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none}
.abtn.go{background:linear-gradient(135deg,var(--green),#00aa55);color:#000}
.abtn.spin{background:linear-gradient(135deg,var(--pink),#cc0044);color:#fff}
.abtn.cashout{background:linear-gradient(135deg,var(--yellow),#cc9900);color:#000}
.rbox{margin-top:14px;background:var(--s2);border:1px solid var(--br);border-radius:10px;padding:13px;
  text-align:center;min-height:50px;display:flex;align-items:center;justify-content:center}
.rtxt{font-family:'Orbitron',sans-serif;font-size:.88rem;font-weight:700}
.win{color:var(--green);text-shadow:0 0 18px rgba(0,255,136,.4)}
.lose{color:var(--pink);text-shadow:0 0 18px rgba(255,45,120,.3)}
.neutral{color:var(--dim)}
.hrow{display:flex;gap:6px;overflow-x:auto;padding:9px 0 2px;flex-wrap:wrap}
.hchip{flex-shrink:0;padding:3px 9px;border-radius:20px;font-family:'Orbitron',sans-serif;font-size:.58rem;font-weight:700;border:1px solid}
.hw{border-color:var(--green);color:var(--green);background:rgba(0,255,136,.07)}
.hl{border-color:var(--pink);color:var(--pink);background:rgba(255,45,120,.07)}

/* ‚îÄ‚îÄ CRASH ‚îÄ‚îÄ */
.crash-wrap{position:relative;background:var(--s2);border:1px solid var(--br);border-radius:10px;
  overflow:hidden;margin-bottom:14px;height:200px}
#crashCanvas{position:absolute;inset:0;width:100%;height:100%}
#crashMult{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'Orbitron',sans-serif;
  font-size:2.5rem;font-weight:900;pointer-events:none;transition:color .2s;text-shadow:0 0 28px currentColor}
#crashStat{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);font-size:.72rem;letter-spacing:.09em;
  color:var(--dim);background:rgba(4,6,15,.8);padding:3px 12px;border-radius:20px;white-space:nowrap}

/* ‚îÄ‚îÄ DICE ‚îÄ‚îÄ */
.dice-row{display:flex;gap:16px;justify-content:center;margin:16px 0}
.die{width:64px;height:64px;background:var(--s2);border:2px solid var(--br);border-radius:12px;
  display:flex;align-items:center;justify-content:center;font-size:2.2rem}
@keyframes dspin{0%,100%{transform:rotate(0) scale(1)}40%{transform:rotate(-18deg) scale(1.15)}70%{transform:rotate(18deg) scale(1.15)}}
.die.r{animation:dspin .35s ease}
.dtotal{text-align:center;font-family:'Orbitron',sans-serif;font-size:1.5rem;font-weight:700;color:var(--blue);margin-bottom:12px}
.dopt{display:flex;align-items:center;gap:10px;flex-wrap:wrap;background:var(--s2);border:1px solid var(--br);
  border-radius:8px;padding:10px 14px;margin-bottom:12px}
.dopt select,.dopt input[type=number]{background:var(--s1);border:1px solid var(--br);border-radius:5px;
  color:var(--text);font-family:'Rajdhani',sans-serif;font-size:.88rem;padding:5px 8px;outline:none}
.dpayout{margin-left:auto;font-family:'Orbitron',sans-serif;font-size:.74rem;color:var(--yellow)}

/* ‚îÄ‚îÄ ROULETTE ‚îÄ‚îÄ */
.rlayout{display:flex;gap:22px;flex-wrap:wrap;align-items:flex-start}
.warea{display:flex;flex-direction:column;align-items:center;gap:8px}
.wptr{font-size:1.3rem;color:var(--xrs);text-shadow:0 0 8px var(--xrs)}
.wheel{width:180px;height:180px;border-radius:50%;
  background:conic-gradient(#c0392b 0 9.73deg,#2c3e50 9.73deg 19.46deg,#c0392b 19.46deg 29.19deg,#2c3e50 29.19deg 38.92deg,#c0392b 38.92deg 48.65deg,#2c3e50 48.65deg 58.38deg,#c0392b 58.38deg 68.11deg,#2c3e50 68.11deg 77.84deg,#c0392b 77.84deg 87.57deg,#00a838 87.57deg 97.3deg,#c0392b 97.3deg 107.03deg,#2c3e50 107.03deg 116.76deg,#c0392b 116.76deg 126.49deg,#2c3e50 126.49deg 136.22deg,#c0392b 136.22deg 145.95deg,#2c3e50 145.95deg 155.68deg,#c0392b 155.68deg 165.41deg,#2c3e50 165.41deg 175.14deg,#c0392b 175.14deg 184.87deg,#2c3e50 184.87deg 194.6deg,#c0392b 194.6deg 204.33deg,#2c3e50 204.33deg 214.06deg,#c0392b 214.06deg 223.79deg,#2c3e50 223.79deg 233.52deg,#c0392b 233.52deg 243.25deg,#2c3e50 243.25deg 252.98deg,#c0392b 252.98deg 262.71deg,#2c3e50 262.71deg 272.44deg,#c0392b 272.44deg 282.17deg,#2c3e50 282.17deg 291.9deg,#c0392b 291.9deg 301.63deg,#2c3e50 301.63deg 311.36deg,#c0392b 311.36deg 321.09deg,#2c3e50 321.09deg 330.82deg,#c0392b 330.82deg 340.55deg,#00a838 340.55deg 360deg);
  border:3px solid #1a2540;box-shadow:0 0 28px rgba(0,0,0,.6),inset 0 0 18px rgba(0,0,0,.4);
  transition:transform 3.2s cubic-bezier(.17,.67,.1,.99);position:relative}
.wc2{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:24px;height:24px;
  border-radius:50%;background:var(--bg);border:2px solid #1a2540}
.wnum{font-family:'Orbitron',sans-serif;font-size:1.4rem;font-weight:900;min-width:44px;text-align:center}
.barea{flex:1;min-width:200px}
.ogrid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;margin-bottom:10px}
.bchip{padding:8px 4px;text-align:center;border:1px solid var(--br);border-radius:6px;cursor:pointer;
  font-size:.82rem;font-weight:600;transition:background .14s,border-color .14s;user-select:none}
.bchip:hover{border-color:var(--xrs);background:rgba(200,255,0,.07)}
.bchip.sel{border-color:var(--xrs)!important;background:rgba(200,255,0,.14)!important}
.nrow{display:flex;align-items:center;gap:8px;margin-bottom:10px}
.nrow input{background:var(--s2);border:1px solid var(--br);border-radius:5px;color:var(--text);
  font-family:'Orbitron',sans-serif;font-size:.78rem;padding:6px 8px;width:72px;outline:none}
.nrow input:focus{border-color:var(--xrs)}

/* ‚îÄ‚îÄ BLACKJACK ‚îÄ‚îÄ */
.felt{background:radial-gradient(ellipse at center,#0d3320 0%,#071a10 100%);border-radius:14px;
  padding:18px;border:2px solid #1a4a28;box-shadow:inset 0 0 36px rgba(0,0,0,.6)}
.bjlbl{font-size:.62rem;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.3);margin-bottom:6px}
.cardrow{display:flex;gap:6px;flex-wrap:wrap;min-height:78px;align-items:center;margin-bottom:6px}
.card{width:50px;height:72px;background:#fff;border-radius:7px;border:1px solid #ddd;display:flex;
  flex-direction:column;justify-content:space-between;padding:4px 5px;font-weight:700;font-size:.85rem;
  box-shadow:2px 3px 7px rgba(0,0,0,.5);color:#222}
.card.red{color:#c0392b}
.card.back{background:repeating-linear-gradient(45deg,#0a2050,#0a2050 5px,#061535 5px,#061535 10px);border-color:#1a3a8a}
.sbadge{display:inline-block;background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.14);border-radius:20px;
  padding:3px 10px;font-family:'Orbitron',sans-serif;font-size:.72rem;color:#fff}
.bjbtns{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.bjb{padding:8px 16px;border:1px solid;border-radius:7px;font-family:'Rajdhani',sans-serif;font-size:.88rem;
  font-weight:700;letter-spacing:.04em;text-transform:uppercase;cursor:pointer;transition:all .18s}
.bjb:disabled{opacity:.3;cursor:not-allowed}
.bjdeal{border-color:var(--blue);color:var(--blue);background:rgba(0,212,255,.06)}
.bjdeal:hover:not(:disabled){background:var(--blue);color:#000}
.bjhit{border-color:var(--green);color:var(--green);background:rgba(0,255,136,.06)}
.bjhit:hover:not(:disabled){background:var(--green);color:#000}
.bjstand{border-color:var(--pink);color:var(--pink);background:rgba(255,45,120,.06)}
.bjstand:hover:not(:disabled){background:var(--pink);color:#fff}
.bjdbl{border-color:var(--yellow);color:var(--yellow);background:rgba(255,215,0,.06)}
.bjdbl:hover:not(:disabled){background:var(--yellow);color:#000}


/* ‚îÄ‚îÄ TICKER ‚îÄ‚îÄ */
.ticker{background:var(--s2);border:1px solid var(--br);border-radius:8px;padding:8px 16px 8px 58px;
  overflow:hidden;margin-bottom:24px;position:relative;height:36px}
.livebadge{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:.52rem;font-weight:700;
  letter-spacing:.12em;color:var(--xrs);background:rgba(200,255,0,.1);border:1px solid rgba(200,255,0,.25);
  padding:2px 6px;border-radius:4px;animation:bl 1.2s infinite}
@keyframes bl{0%,100%{opacity:1}50%{opacity:.3}}
.ttrack{display:flex;gap:26px;white-space:nowrap;animation:tscroll 26s linear infinite}
@keyframes tscroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
.tick{display:inline-flex;gap:6px;align-items:center;font-size:.76rem}
.tu{color:var(--dim)}.tg{color:var(--blue)}.tw{color:var(--green);font-family:'Orbitron',sans-serif;font-size:.66rem}
.tl{color:var(--pink);font-family:'Orbitron',sans-serif;font-size:.66rem}

/* ‚îÄ‚îÄ LANDING ‚îÄ‚îÄ */
#landingSection{position:relative;z-index:5;display:flex;flex-direction:column;align-items:center;
  justify-content:center;min-height:calc(100vh - 70px);padding:40px 32px;text-align:center}
.landing-hero{max-width:600px;margin:0 auto}
.landing-tag{font-size:.66rem;letter-spacing:.2em;text-transform:uppercase;color:var(--xrs);
  font-family:'Orbitron',sans-serif;margin-bottom:16px;opacity:.8}
.landing-title{font-family:'Orbitron',sans-serif;font-size:clamp(2rem,5vw,3.2rem);font-weight:900;
  line-height:1.15;margin-bottom:16px;text-shadow:0 0 40px rgba(200,255,0,.15)}
.landing-title span{color:var(--xrs)}
.landing-sub{color:var(--dim);font-size:1rem;line-height:1.6;margin-bottom:32px;max-width:480px;margin-inline:auto}
.landing-cta{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
.cta-primary{padding:13px 32px;background:linear-gradient(135deg,var(--xrs),var(--xrs2));border:none;
  border-radius:10px;color:#070c00;font-family:'Orbitron',sans-serif;font-size:.82rem;font-weight:700;
  letter-spacing:.06em;cursor:pointer;transition:box-shadow .2s,transform .1s}
.cta-primary:hover{box-shadow:0 0 28px rgba(200,255,0,.5);transform:translateY(-2px)}
.cta-secondary{padding:13px 32px;background:transparent;border:1px solid var(--br);
  border-radius:10px;color:var(--text);font-family:'Orbitron',sans-serif;font-size:.82rem;font-weight:700;
  letter-spacing:.06em;cursor:pointer;transition:border-color .2s}
.cta-secondary:hover{border-color:var(--blue)}
.landing-features{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;
  margin-top:48px;max-width:700px;margin-inline:auto}
.feat{background:var(--s1);border:1px solid var(--br);border-radius:12px;padding:18px 16px;text-align:center}
.feat-icon{font-size:1.8rem;margin-bottom:8px}
.feat-name{font-family:'Orbitron',sans-serif;font-size:.72rem;font-weight:700;color:var(--text);margin-bottom:4px}
.feat-desc{font-size:.76rem;color:var(--dim);line-height:1.4}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#xpToast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--s1);
  border:1px solid var(--br);border-radius:10px;padding:10px 22px;font-family:'Orbitron',sans-serif;
  font-size:.72rem;font-weight:700;letter-spacing:.04em;z-index:9999;
  transition:transform .35s cubic-bezier(.34,1.56,.64,1),opacity .35s;opacity:0;pointer-events:none;
  white-space:nowrap;box-shadow:0 8px 32px rgba(0,0,0,.5)}

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
footer{position:relative;z-index:5;border-top:1px solid var(--br);padding:14px 32px;
  display:flex;align-items:center;justify-content:space-between;font-size:.72rem;color:var(--dim)}
.flogo{font-family:'Orbitron',sans-serif;font-size:.82rem;color:var(--xrs)}
.flinks{display:flex;gap:16px}
.flinks a{color:var(--dim);text-decoration:none;transition:color .2s}
.flinks a:hover{color:var(--text)}

@media(max-width:640px){
  header,main,footer,#landingSection{padding-left:14px;padding-right:14px}
  .hdr-right{gap:6px}
  #crashMult{font-size:1.8rem}
  .rlayout{flex-direction:column}
  .dash-stats{grid-template-columns:repeat(3,1fr)}
  .dash-actions{grid-template-columns:1fr 1fr}
}

/* ‚îÄ‚îÄ‚îÄ ESCROW WALLET BAR ‚îÄ‚îÄ‚îÄ */
.escrow-bar{display:flex;align-items:center;gap:10px;padding:11px 15px;margin-bottom:14px;
  background:rgba(200,255,0,.04);border:1px solid rgba(200,255,0,.2);border-radius:10px;flex-wrap:wrap}
.escrow-bar.warn{background:rgba(255,215,0,.05);border-color:rgba(255,215,0,.25)}
.escrow-dot{width:9px;height:9px;border-radius:50%;flex-shrink:0}
.escrow-dot.on{background:var(--green);box-shadow:0 0 7px var(--green)}
.escrow-dot.warn{background:var(--yellow);box-shadow:0 0 6px var(--yellow)}
.escrow-col{flex:1;min-width:0;overflow:hidden}
.escrow-lbl{font-size:.62rem;letter-spacing:.09em;text-transform:uppercase;color:var(--dim);margin-bottom:1px}
.escrow-val{font-family:'Orbitron',sans-serif;font-size:.73rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.escrow-badge{display:inline-flex;align-items:center;gap:3px;border-radius:5px;padding:1px 7px;
  font-size:.63rem;letter-spacing:.06em;font-weight:600;vertical-align:middle;margin-left:6px}
.escrow-badge.live{background:rgba(0,255,136,.12);border:1px solid rgba(0,255,136,.3);color:var(--green)}
.escrow-badge.off{background:rgba(255,215,0,.1);border:1px solid rgba(255,215,0,.28);color:var(--yellow)}
.escrow-edit{background:none;border:1px solid var(--br);border-radius:6px;color:var(--dim);
  font-size:.65rem;padding:3px 9px;cursor:pointer;font-family:'Rajdhani',sans-serif;
  white-space:nowrap;flex-shrink:0;transition:border-color .2s,color .2s}
.escrow-edit:hover{border-color:var(--xrs);color:var(--xrs)}
.escrow-form{display:none;width:100%;margin-top:8px;gap:8px;align-items:flex-start;flex-direction:column}
.escrow-form.open{display:flex}
.escrow-row{display:flex;gap:8px;width:100%}
.escrow-input{flex:1;background:var(--bg);border:1px solid var(--br);color:var(--text);
  font-family:'Rajdhani',sans-serif;font-size:.88rem;padding:8px 12px;border-radius:7px;outline:none;
  transition:border-color .2s}
.escrow-input:focus{border-color:var(--xrs)}
.escrow-save{background:linear-gradient(135deg,var(--xrs),var(--xrs2));border:none;border-radius:7px;
  color:#060a00;font-family:'Orbitron',sans-serif;font-size:.67rem;font-weight:700;
  padding:8px 14px;cursor:pointer;white-space:nowrap}
.escrow-err{font-size:.72rem;color:var(--pink);display:none}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tweetnacl/1.0.3/nacl.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bs58@4.0.1/index.js"></script>
<script src="/js/casino.js"></script>
</head>
<body>
<div class="glow-orb"></div>

<!-- HEADER -->
<header>
  <div class="logo" onclick="goHome()">XERIS<b>.PLAY</b></div>
  <div class="hdr-right">
    <div class="bal-bar" id="balBar" style="display:none">
      <div>
        <div class="bal-label">Balance</div>
        <div id="balDisp">0.00 XRS</div>
      </div>
    </div>
    <button class="hdr-user-btn" id="hdrUserBtn" style="display:none" onclick="openDashboard()">
      <span class="hdr-dot"></span>
      <span id="hdrUsername">Player</span>
    </button>
    <button class="hdr-login-btn" id="hdrLoginBtn" onclick="connectXerisWallet()">üîó Connect Wallet</button>
  </div>
</header>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     AUTH MODAL (Login / Register)
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay" id="authOverlay" onclick="bgClose(event,'authOverlay')">
  <div class="modal">
    <div class="modal-head">
      <span class="modal-title" id="authTitle">SIGN IN</span>
      <button class="modal-close" onclick="closeAuth()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="auth-tabs">
        <div class="auth-tab active" id="tabLogin" onclick="switchAuthTab('login')">SIGN IN</div>
        <div class="auth-tab" id="tabRegister" onclick="switchAuthTab('register')">REGISTER</div>
      </div>
      <!-- Login form -->
      <div id="loginForm">
        <div class="form-group">
          <label class="form-label">Username</label>
          <input class="form-input" id="loginUser" type="text" placeholder="Enter username" autocomplete="username"/>
          <div class="form-error" id="loginError"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input class="form-input" id="loginPass" type="password" placeholder="Enter password" autocomplete="current-password"/>
        </div>
        <button class="form-submit" id="loginBtn" onclick="doLogin()">SIGN IN</button>
      </div>
      <!-- Register form -->
      <div id="registerForm" style="display:none">
        <div class="form-group">
          <label class="form-label">Username</label>
          <input class="form-input" id="regUser" type="text" placeholder="Choose a username (3-20 chars)" autocomplete="username"/>
          <div class="form-error" id="regUserError"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input class="form-input" id="regPass" type="password" placeholder="Create a password (min 6 chars)" autocomplete="new-password"/>
          <div class="form-error" id="regPassError"></div>
        </div>
        <div class="form-group">
          <label class="form-label">XRS Deposit Address <span style="color:var(--dim)">(optional)</span></label>
          <input class="form-input" id="regAddr" type="text" placeholder="XRS wallet address ‚Äî wins airdropped here (optional)" autocomplete="off"/>
          <div class="form-error" id="regAddrError"></div>
        </div>
        <button class="form-submit" id="registerBtn" onclick="doRegister()">CREATE ACCOUNT</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     DASHBOARD MODAL
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay" id="dashOverlay" onclick="bgClose(event,'dashOverlay')">
  <div class="modal dash-modal">
    <div class="modal-head">
      <span class="modal-title">MY DASHBOARD</span>
      <button class="modal-close" onclick="closeDashboard()">‚úï</button>
    </div>

    <!-- Main dashboard view -->
    <div id="dashMain">
      <div class="dash-header">
        <div class="dash-avatar" id="dashAvatar">?</div>
        <div>
          <div class="dash-name" id="dashName">‚Äî</div>
          <div class="dash-since" id="dashSince">Member since ‚Äî</div>
        </div>
        <div style="margin-left:auto">
          <div class="pending-badge" id="pendingBadge" style="display:none">
            <span>‚è≥</span> PENDING
          </div>
        </div>
      </div>
      <div class="dash-body">
        <!-- ESCROW PAYOUT WALLET ‚Äî xeris-arcade airdrop pattern -->
        <div class="escrow-bar warn" id="escrowBar">
          <div class="escrow-dot warn" id="escrowDot"></div>
          <div class="escrow-col">
            <div class="escrow-lbl">Payout Wallet<span class="escrow-badge off" id="escrowBadge">BALANCE ONLY</span></div>
            <div class="escrow-val" id="escrowVal" style="color:var(--yellow)">Add your XRS address to receive on-chain payouts</div>
          </div>
          <button class="escrow-edit" onclick="toggleEscrowEdit(event)">‚úé Edit</button>
        </div>
        <div class="escrow-form" id="escrowForm">
          <div class="escrow-row">
            <input class="escrow-input" id="escrowInput" type="text" placeholder="Your XRS wallet address (base58)‚Ä¶" autocomplete="off"/>
            <button class="escrow-save" onclick="saveEscrowWallet()">SAVE</button>
          </div>
          <div class="escrow-err" id="escrowErr"></div>
        </div>
        <div class="dash-stats">
          <div class="dstat">
            <div class="dstat-lbl">Balance</div>
            <div class="dstat-val" id="dashBal" style="color:var(--yellow)">0.00 XRS</div>
          </div>
          <div class="dstat">
            <div class="dstat-lbl">Total Won</div>
            <div class="dstat-val" id="dashWon" style="color:var(--green)">0.00 XRS</div>
          </div>
          <div class="dstat">
            <div class="dstat-lbl">Games</div>
            <div class="dstat-val" id="dashGames" style="color:var(--blue)">0</div>
          </div>
        </div>

        <div class="dash-actions">
          <button class="dash-action-btn btn-deposit" onclick="connectXerisWallet()" id="connectWalletBtn">
            <span>‚¨á</span> DEPOSIT
          </button>
          <button class="dash-action-btn btn-withdraw" style="display:none" onclick="showPanel('withdraw')">
            <span>‚¨Ü</span> WITHDRAW
          </button>
          <button class="dash-action-btn btn-faucet" onclick="claimFaucet()">
            <span>üö∞</span> FREE XRS
          </button>
          <button class="dash-action-btn btn-logout" onclick="doLogout()">
            <span>‚èè</span> LOGOUT
          </button>
        </div>

        <div class="tx-section-title">Transaction History</div>
        <div class="tx-list" id="txList">
          <div class="tx-empty">No transactions yet</div>
        </div>
      </div>
    </div>

    <!-- WALLET CONNECT panel -->
      <div class="txn-panel" id="depositPanel">
        <div style="text-align:center;padding:20px;">
          <div style="font-size:48px;margin-bottom:16px;">üîó</div>
          <h3 style="color:var(--xrs);margin-bottom:8px;">Connect Xeris Wallet</h3>
          <p style="color:var(--dim);margin-bottom:20px;font-size:.9rem;">Open this site in your Xeris Wallet browser to connect automatically, or connect below.</p>
          <div id="walletConnectStatus" style="margin-bottom:16px;"></div>
          <button class="form-submit" onclick="connectXerisWallet()">CONNECT WALLET</button>
          <div id="walletConnectError" class="form-error"></div>
        </div>
      </div>
<!-- WITHDRAW panel -->
    <div class="txn-panel" id="withdrawPanel">
      <div class="modal-head" style="border-bottom:none;padding-bottom:0">
        <span class="modal-title">WITHDRAW XRS</span>
        <button class="modal-close" onclick="closeDashboard()">‚úï</button>
      </div>
      <div class="dash-body" style="padding-top:14px">
        <button class="txn-back" onclick="showPanel('main')">‚Üê Back to Dashboard</button>
        <div class="form-group">
          <label class="form-label">Your XRS Withdrawal Address</label>
          <input class="form-input" id="withdrawAddr" type="text" placeholder="XRS address to receive funds"/>
          <div class="form-error" id="withdrawAddrErr"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Amount (XRS)</label>
          <input class="form-input" id="withdrawAmt" type="number" min="1" step="1" placeholder="Amount to withdraw" oninput="updateWithdrawPreview()"/>
          <div class="xrs-quick-btns">
            <button class="xrs-quick" onclick="setWdrAmt('half')">¬Ω Balance</button>
            <button class="xrs-quick" onclick="setWdrAmt('all')">All</button>
          </div>
          <div class="form-error" id="withdrawAmtErr"></div>
        </div>
        <!-- Fee preview -->
        <div id="withdrawPreview" style="display:none;background:var(--s2);border:1px solid var(--br);border-radius:8px;padding:11px 14px;margin-bottom:14px;font-size:.8rem">
          <div style="display:flex;justify-content:space-between;margin-bottom:5px">
            <span style="color:var(--dim)">Requested amount</span>
            <span id="wdrGross" style="font-family:'Orbitron',sans-serif;font-size:.76rem">‚Äî</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:5px">
            <span style="color:var(--pink)">2% platform fee</span>
            <span id="wdrFee" style="font-family:'Orbitron',sans-serif;font-size:.76rem;color:var(--pink)">‚Äî</span>
          </div>
          <div style="display:flex;justify-content:space-between;border-top:1px solid var(--br);padding-top:6px;margin-top:2px">
            <span style="color:var(--yellow);font-weight:700">You receive</span>
            <span id="wdrNet" style="font-family:'Orbitron',sans-serif;font-size:.78rem;color:var(--yellow);font-weight:700">‚Äî</span>
          </div>
        </div>
        <div class="form-error" id="withdrawError"></div>
        <button class="form-submit" id="withdrawBtn" onclick="submitWithdraw()">WITHDRAW NOW</button>
        <p style="font-size:.72rem;color:var(--dim);text-align:center;margin-top:12px;line-height:1.5">
          ‚ö° Withdrawals are sent automatically to your XRS address. A 2% fee is retained. Minimum: 10 XRS.
        </p>
      </div>
    </div>

  </div>
</div>

<!-- LANDING PAGE -->
<div id="landingSection">
  <div class="landing-hero">
    <div class="landing-tag">Powered by Xeris Blockchain</div>
    <h1 class="landing-title">Play Fair.<br><span>Win Big.</span><br>On-Chain.</h1>
    <p class="landing-sub">4 provably fair casino games. Real XRS currency. Zero house edge. Create your account and start playing in seconds.</p>
    <div class="landing-cta">
      <button class="cta-primary" onclick="openAuth('register')">Create Account</button>
      <button class="cta-secondary" onclick="openAuth('login')">Sign In</button>
    </div>
    <div class="landing-features">
      <div class="feat"><div class="feat-icon">üöÄ</div><div class="feat-name">CRASH</div><div class="feat-desc">Multiplier up to 1000√ó</div></div>
      <div class="feat"><div class="feat-icon">üé≤</div><div class="feat-name">DICE</div><div class="feat-desc">Over, under, exact</div></div>
      <div class="feat"><div class="feat-icon">üé°</div><div class="feat-name">ROULETTE</div><div class="feat-desc">35√ó straight-up payout</div></div>
      <div class="feat"><div class="feat-icon">üÉè</div><div class="feat-name">BLACKJACK</div><div class="feat-desc">3:2 on natural BJ</div></div>
    </div>
  </div>
</div>

<!-- GAME SECTION (hidden until logged in) -->
<main id="gameSection">
  <div class="ticker"><div class="livebadge">LIVE</div><div class="ttrack" id="ttrack"></div></div>
  <div class="sec-title">Choose Your Game</div>
  <div class="game-grid">
    <div class="gcard" id="card-crash" style="--ac:var(--blue)">
      <div class="ch"><div class="cicon">üöÄ</div><div class="cbadge">HOT</div></div>
      <div class="cb"><div class="cname">CRASH</div><div class="cdesc">Watch the multiplier climb. Cash out before it crashes or lose it all.</div>
        <div class="cstats"><div class="stat"><div class="sl">Max Win</div><div class="sv">1000√ó</div></div><div class="stat"><div class="sl">Edge</div><div class="sv">0%</div></div></div>
        <button class="pbtn" onclick="openGame('crash')">Play Now</button></div>
    </div>
    <div class="gcard" id="card-dice" style="--ac:var(--green)">
      <div class="ch"><div class="cicon">üé≤</div><div class="cbadge">CLASSIC</div></div>
      <div class="cb"><div class="cname">DICE</div><div class="cdesc">Roll two dice and predict the outcome ‚Äî over, under, or exact.</div>
        <div class="cstats"><div class="stat"><div class="sl">Max Win</div><div class="sv">35√ó</div></div><div class="stat"><div class="sl">Edge</div><div class="sv">0%</div></div></div>
        <button class="pbtn" onclick="openGame('dice')">Play Now</button></div>
    </div>
    <div class="gcard" id="card-roulette" style="--ac:var(--pink)">
      <div class="ch"><div class="cicon">üé°</div><div class="cbadge">POPULAR</div></div>
      <div class="cb"><div class="cname">ROULETTE</div><div class="cdesc">Red or black, odd or even ‚Äî or pick a number for 35√ó payout.</div>
        <div class="cstats"><div class="stat"><div class="sl">Max Win</div><div class="sv">35√ó</div></div><div class="stat"><div class="sl">Edge</div><div class="sv">0%</div></div></div>
        <button class="pbtn" onclick="openGame('roulette')">Play Now</button></div>
    </div>
    <div class="gcard" id="card-blackjack" style="--ac:var(--yellow)">
      <div class="ch"><div class="cicon">üÉè</div><div class="cbadge">STRATEGY</div></div>
      <div class="cb"><div class="cname">BLACKJACK</div><div class="cdesc">Beat the dealer to 21. Hit, stand, or double down to win.</div>
        <div class="cstats"><div class="stat"><div class="sl">Blackjack</div><div class="sv">3:2</div></div><div class="stat"><div class="sl">Edge</div><div class="sv">0%</div></div></div>
        <button class="pbtn" onclick="openGame('blackjack')">Play Now</button></div>
    </div>
  </div>

  <!-- CRASH -->
  <div class="arena" id="arena-crash">
    <div class="ah"><span style="font-size:1.2rem">üöÄ</span><span class="at">CRASH</span><button class="acl" onclick="closeGame()">‚úï Close</button></div>
    <div class="ab">
      <div class="crash-wrap"><canvas id="crashCanvas"></canvas><div id="crashMult" style="color:var(--green)">1.00√ó</div><div id="crashStat">Place a bet to start</div></div>
      <div class="bet-row">
        <span class="blbl">Bet</span><input class="binput" id="cBet" type="number" value="10" min="0.01" step="0.01">
        <button class="qbtn" onclick="setQ('cBet',5)">5</button><button class="qbtn" onclick="setQ('cBet',25)">25</button>
        <button class="qbtn" onclick="half('cBet')">¬Ω</button><button class="qbtn" onclick="dbl('cBet')">2√ó</button>
        <button class="abtn" id="crashBtn" onclick="crashAction()">Place Bet</button>
      </div>
      <div class="rbox"><span class="rtxt neutral" id="crashRes">Set your bet and click Place Bet</span></div>
      <div class="hrow" id="crashH"></div>
    </div>
  </div>

  <!-- DICE -->
  <div class="arena" id="arena-dice">
    <div class="ah"><span style="font-size:1.2rem">üé≤</span><span class="at">DICE</span><button class="acl" onclick="closeGame()">‚úï Close</button></div>
    <div class="ab">
      <div class="dice-row"><div class="die" id="die1">‚öÄ</div><div class="die" id="die2">‚öÄ</div></div>
      <div class="dtotal" id="dtotal">Roll the dice!</div>
      <div class="dopt">
        <span class="blbl">Predict</span>
        <select id="diceMode" onchange="refreshDP()"><option value="over">Over</option><option value="under">Under</option><option value="exact">Exact</option></select>
        <input id="diceTgt" type="number" min="2" max="12" value="7" onchange="refreshDP()" style="width:58px">
        <div class="dpayout" id="dpayout">Payout: 2.06√ó</div>
      </div>
      <div class="bet-row">
        <span class="blbl">Bet</span><input class="binput" id="dBet" type="number" value="10" min="0.01" step="0.01">
        <button class="qbtn" onclick="half('dBet')">¬Ω</button><button class="qbtn" onclick="dbl('dBet')">2√ó</button>
        <button class="abtn go" id="diceBtn" onclick="rollDice()">Roll!</button>
      </div>
      <div class="rbox"><span class="rtxt neutral" id="diceRes">Set prediction then roll</span></div>
      <div class="hrow" id="diceH"></div>
    </div>
  </div>

  <!-- ROULETTE -->
  <div class="arena" id="arena-roulette">
    <div class="ah"><span style="font-size:1.2rem">üé°</span><span class="at">ROULETTE</span><button class="acl" onclick="closeGame()">‚úï Close</button></div>
    <div class="ab">
      <div class="rlayout">
        <div class="warea">
          <div class="wptr">‚ñº</div>
          <div class="wheel" id="rWheel"><div class="wc2"></div></div>
          <div class="wnum" id="rNum" style="color:var(--dim)">‚Äî</div>
        </div>
        <div class="barea">
          <div style="font-size:.64rem;letter-spacing:.1em;text-transform:uppercase;color:var(--dim);margin-bottom:6px">Outside Bets (1:1)</div>
          <div class="ogrid">
            <div class="bchip" id="ob-red" onclick="pickOB('red')" style="color:#ff6060">üî¥ Red</div>
            <div class="bchip" id="ob-black" onclick="pickOB('black')" style="color:#aaa">‚ö´ Black</div>
            <div class="bchip" id="ob-even" onclick="pickOB('even')">Even</div>
            <div class="bchip" id="ob-odd" onclick="pickOB('odd')">Odd</div>
            <div class="bchip" id="ob-low" onclick="pickOB('low')">1‚Äì18</div>
            <div class="bchip" id="ob-high" onclick="pickOB('high')">19‚Äì36</div>
          </div>
          <div style="font-size:.64rem;letter-spacing:.1em;text-transform:uppercase;color:var(--dim);margin-bottom:6px">Straight Up (35:1)</div>
          <div class="nrow"><input id="rPick" type="number" min="0" max="36" placeholder="0‚Äì36" oninput="clearOB()"><span style="color:var(--dim);font-size:.76rem">‚Üí 35√ó</span></div>
          <div class="bet-row">
            <span class="blbl">Bet</span><input class="binput" id="rBet" type="number" value="10" min="0.01" step="0.01">
            <button class="qbtn" onclick="half('rBet')">¬Ω</button><button class="qbtn" onclick="dbl('rBet')">2√ó</button>
            <button class="abtn spin" id="rBtn" onclick="spinR()">Spin!</button>
          </div>
        </div>
      </div>
      <div class="rbox"><span class="rtxt neutral" id="rRes">Choose a bet then spin</span></div>
      <div class="hrow" id="rH"></div>
    </div>
  </div>

  <!-- BLACKJACK -->
  <div class="arena" id="arena-blackjack">
    <div class="ah"><span style="font-size:1.2rem">üÉè</span><span class="at">BLACKJACK</span><button class="acl" onclick="closeGame()">‚úï Close</button></div>
    <div class="ab">
      <div class="bet-row" style="margin-bottom:14px">
        <span class="blbl">Bet</span><input class="binput" id="bjBet" type="number" value="10" min="0.01" step="0.01">
        <button class="qbtn" onclick="half('bjBet')">¬Ω</button><button class="qbtn" onclick="dbl('bjBet')">2√ó</button>
        <span style="color:var(--dim);font-size:.76rem;margin-left:auto" id="bjBetShow">Current bet: 10 XRS</span>
      </div>
      <div class="felt">
        <div class="bjlbl">Dealer</div><div class="cardrow" id="dHand"></div><div class="sbadge" id="dScore">?</div>
        <div style="border-top:1px solid rgba(255,255,255,.07);margin:12px 0"></div>
        <div class="bjlbl">You</div><div class="cardrow" id="pHand"></div><div class="sbadge" id="pScore">‚Äî</div>
        <div class="bjbtns">
          <button class="bjb bjdeal" id="bjDeal" onclick="bjDeal()">Deal</button>
          <button class="bjb bjhit" id="bjHit" onclick="bjHit()" disabled>Hit</button>
          <button class="bjb bjstand" id="bjStand" onclick="bjStand()" disabled>Stand</button>
          <button class="bjb bjdbl" id="bjDbl" onclick="bjDouble()" disabled>Double</button>
        </div>
      </div>
      <div class="rbox"><span class="rtxt neutral" id="bjRes">Set your bet and click Deal</span></div>
      <div class="hrow" id="bjH"></div>
    </div>
  </div>

</main>

<footer>
  <div class="flogo">XERIS<b style="color:var(--blue)">.PLAY</b></div>
  <div class="flinks"><a href="#">Fairness</a><a href="#">Support</a><a href="#">Terms</a></div>
  <div>¬© 2026 Xeris.Play ¬∑ Powered by Xeris Blockchain ¬∑ 0% House Edge</div>
</footer>

<div id="xpToast"></div>

<script>
'use strict';
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   XERIS.PLAY v2.0  ‚Äî  Username + balance dashboard
   Treasury: 6G4GroMrVsGjd3xhywxfzXDg7vPn1V2Mky4B3qsXVGHo
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const TREASURY        = '6G4GroMrVsGjd3xhywxfzXDg7vPn1V2Mky4B3qsXVGHo';
const FEE_RATE        = 0.02;   // 2% fee on deposits AND withdrawals ‚Üí treasury
const FAUCET_AMOUNT   = 100;    // XRS per claim
const FAUCET_COOLDOWN_H = 24;   // hours between faucet claims

/* ‚îÄ‚îÄ Xeris node config ‚îÄ‚îÄ */
const IS_PROD  = location.protocol === 'https:';
const PROXY    = '/api/proxy';
const NODE_IP  = '138.197.116.81';
const RPC_PORT = 50008;
const NET_PORT = 56001;
const LAMPORTS = 1_000_000_000;
const LAM = n  => Math.round(n * LAMPORTS);

function rpcUrl()  { return IS_PROD ? `${PROXY}?target=rpc`             : `http://${NODE_IP}:${RPC_PORT}/rpc`; }
function netBase() { return IS_PROD ? `${PROXY}?target=net`             : `http://${NODE_IP}:${NET_PORT}`; }
function apiBase() { return IS_PROD ? `${PROXY}?target=api`             : `http://${NODE_IP}:${RPC_PORT}`; }

async function xerisRPC(method, params = []) {
  const ctl = new AbortController();
  const tid = setTimeout(() => ctl.abort(), 10000);
  try {
    const r = await fetch(rpcUrl(), {
      method: 'POST', signal: ctl.signal,
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({jsonrpc:'2.0',id:1,method,params})
    });
    const d = await r.json();
    if (d.error) throw new Error(d.error.message || 'RPC error');
    return d.result;
  } finally { clearTimeout(tid); }
}

async function getBlockhash() {
  try { const r = await xerisRPC('getLatestBlockhash'); return r?.blockhash || r?.value?.blockhash || null; } catch {}
  try { const r = await xerisRPC('getRecentBlockhash'); return r?.blockhash || r?.value?.blockhash || null; } catch {}
  return null;
}

async function submitTx(txBase64) {
  const url = `${netBase()}/submit`;
  const ctl = new AbortController();
  const tid = setTimeout(() => ctl.abort(), 14000);
  try {
    const r = await fetch(url, {
      method: 'POST', signal: ctl.signal,
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({tx_base64: txBase64})
    });
    const txt = await r.text();
    try { return JSON.parse(txt); } catch { return {signature: txt.trim()}; }
  } finally { clearTimeout(tid); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ESCROW ENGINE  ‚îÄ  xeris-arcade pattern
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   xeris-arcade/server.js escrow flow:
     1.  Player registers XRS wallet address
     2.  Player deposits ‚Üí XRS enters treasury/escrow wallet on-chain
     3.  Player bets    ‚Üí balance deducted instantly (off-chain UX)
     4.  Player WINS    ‚Üí server calls  GET /airdrop/:address/:amount
                          Node signs & broadcasts from escrow ‚Üí player
                          No client-side key needed ‚Äî node does it
     5.  Player LOSES   ‚Üí bet stays in escrow (house keeps it)
     6.  Player withdraws ‚Üí autoSend() fires from treasury to player
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* Step 4 core call ‚Äî xeris-arcade's exact airdrop endpoint */
async function escrowAirdrop(toAddress, amountXRS) {
  if (!toAddress || !/^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(toAddress))
    return { ok:false, error:'invalid address' };
  const amt  = parseFloat(amountXRS.toFixed(4));
  const path = `/airdrop/${toAddress}/${amt}`;
  const url  = IS_PROD
    ? `${PROXY}?target=net&path=${encodeURIComponent(path)}`
    : `http://${NODE_IP}:${NET_PORT}${path}`;
  const ctl = new AbortController();
  const tid = setTimeout(() => ctl.abort(), 14000);
  try {
    const r   = await fetch(url, { signal: ctl.signal });
    const txt = await r.text();
    let d;
    try { d = JSON.parse(txt); } catch { d = { raw: txt.trim() }; }
    // Node returns various shapes ‚Äî cover them all
    const sig = d?.signature || d?.txid || d?.id || d?.hash
              || (r.ok && typeof d?.raw === 'string' && d.raw.length > 8 ? d.raw : null);
    if (sig) return { ok:true, signature:sig };
    if (d?.success === true || d?.status === 'ok' || r.ok) return { ok:true, signature:'confirmed' };
    return { ok:false, error: d?.error || d?.message || `HTTP ${r.status}` };
  } catch(e) {
    return { ok:false, error: e.name==='AbortError' ? 'node timeout' : e.message };
  } finally { clearTimeout(tid); }
}

/* Fallback signed transfer (used for manual withdrawals) */
async function signedTransfer(toAddress, amountXRS) {
  try {
    const blockhash = await getBlockhash() || ('bh-'+Date.now());
    const txPayload = {
      recentBlockhash: blockhash,
      feePayer: TREASURY,
      instructions: [{
        programId: '11111111111111111111111111111111',
        type: 'transfer',
        keys: [
          {pubkey: TREASURY,   isSigner: true,  isWritable: true},
          {pubkey: toAddress,  isSigner: false, isWritable: true},
        ],
        data: {instruction: 2, lamports: LAM(amountXRS)}
      }],
      meta: {app:'xeris.play', payout:true, ts:Date.now()}
    };
    const b64 = btoa(unescape(encodeURIComponent(JSON.stringify(txPayload))));
    const d   = await submitTx(b64);
    const sig = d?.signature || d?.txid || d?.id || null;
    return {ok: !!sig, signature:sig, error: d?.error||null};
  } catch(e) {
    return {ok: false, signature:null, error: e.message};
  }
}

/* autoSend: tries airdrop first, falls back to signed transfer */
async function autoSend(toAddress, amountXRS) {
  const r = await escrowAirdrop(toAddress, amountXRS);
  if (r.ok) return r;
  return signedTransfer(toAddress, amountXRS);
}

/* escrowPayout: called by settleWin on every game win
   ‚Ä¢ Credits balance immediately (non-blocking ‚Äî instant UX)
   ‚Ä¢ Fires on-chain airdrop to player's registered wallet async
   ‚Ä¢ Stamps tx history entry with on-chain confirmation once done  */
function escrowPayout(username, amountXRS, gameLabel) {
  const u = DB.getUser(username); if (!u) return;
  const addr  = u.xrsAddress || '';
  const valid = /^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(addr);

  // Always credit balance first ‚Äî instant feedback
  DB.addBalance(username, amountXRS, {
    type:'win', label: gameLabel || 'Win',
    amount:+amountXRS, onChain:false, ts:Date.now()
  });
  DB.recordWin(username, amountXRS);

  if (!valid) return; // No wallet ‚Äî balance win only, done

  // Fire airdrop in background (non-blocking)
  const label = gameLabel || 'Win';
  escrowAirdrop(addr, amountXRS).then(res => {
    const u2 = DB.getUser(username); if (!u2) return;
    // Find our win entry and stamp it with the chain result
    const entry = (u2.txHistory||[]).find(t =>
      t.type === 'win' && t.label === label && !t.onChain && !t.sig);
    if (entry) {
      entry.onChain = res.ok;
      entry.sig     = res.signature || null;
      entry.label   = res.ok
        ? `${label} ‚õì ‚Üí ‚Ä¶${addr.slice(-6)}`
        : `${label} (node offline ‚Äî balance credited)`;
    }
    DB.saveUser(u2);
    if (res.ok)
      toast(`‚õì ${fmtXRS(amountXRS)} airdropped ‚Üí ‚Ä¶${addr.slice(-6)}`, 'var(--blue)');
  }).catch(() => {});
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PERSISTENT STORAGE (localStorage-based user DB)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const DB = {
  // All registered users: { [username_lower]: UserRecord }
  // UserRecord: { username, passwordHash, xrsAddress, balance, totalWon, gamesPlayed,
  //               createdAt, txHistory: [], faucetLastClaim, depositRequests:[], withdrawRequests:[] }

  _key: 'xp_users_v2',
  _sessionKey: 'xp_session_v2',

  _read() {
    try { return JSON.parse(localStorage.getItem(this._key) || '{}'); } catch { return {}; }
  },
  _write(data) {
    try { localStorage.setItem(this._key, JSON.stringify(data)); } catch {}
  },

  // Simple hash (not cryptographic ‚Äî for demo purposes)
  _hash(str) {
    let h = 0;
    for (let i = 0; i < str.length; i++) { h = (Math.imul(31, h) + str.charCodeAt(i)) | 0; }
    return (h >>> 0).toString(36) + str.length.toString(36);
  },

  register(username, password, xrsAddress) {
    const users = this._read();
    const key = username.toLowerCase();
    if (users[key]) return { ok: false, error: 'Username already taken.' };
    const record = {
      username,
      passwordHash: this._hash(password),
      xrsAddress: xrsAddress || '',
      balance: 0,
      totalWon: 0,
      gamesPlayed: 0,
      createdAt: Date.now(),
      txHistory: [],
      faucetLastClaim: 0,
      depositRequests: [],
      withdrawRequests: [],
    };
    users[key] = record;
    this._write(users);
    return { ok: true, user: record };
  },

  login(username, password) {
    const users = this._read();
    const key = username.toLowerCase();
    const u = users[key];
    if (!u) return { ok: false, error: 'Username not found.' };
    if (u.passwordHash !== this._hash(password)) return { ok: false, error: 'Incorrect password.' };
    return { ok: true, user: u };
  },

  getUser(username) {
    const users = this._read();
    return users[username.toLowerCase()] || null;
  },

  saveUser(record) {
    const users = this._read();
    users[record.username.toLowerCase()] = record;
    this._write(users);
  },

  setSession(username) { try { localStorage.setItem(this._sessionKey, username); } catch {} },
  getSession() { try { return localStorage.getItem(this._sessionKey) || null; } catch { return null; } },
  clearSession() { try { localStorage.removeItem(this._sessionKey); } catch {} },

  // Balance mutations
  addBalance(username, amount, txEntry) {
    const u = this.getUser(username); if (!u) return;
    u.balance = Math.max(0, +(u.balance + amount).toFixed(4));
    if (txEntry) u.txHistory.unshift(txEntry);
    if (u.txHistory.length > 100) u.txHistory = u.txHistory.slice(0, 100);
    this.saveUser(u);
  },

  recordWin(username, amount) {
    const u = this.getUser(username); if (!u) return;
    u.totalWon = +(u.totalWon + amount).toFixed(4);
    u.gamesPlayed = (u.gamesPlayed || 0) + 1;
    this.saveUser(u);
  },

  incGames(username) {
    const u = this.getUser(username); if (!u) return;
    u.gamesPlayed = (u.gamesPlayed || 0) + 1;
    this.saveUser(u);
  },
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SESSION
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let _currentUser = null; // live UserRecord copy

function getCurrentUser() {
  if (!_currentUser) return null;
  // Always read fresh from DB
  return DB.getUser(_currentUser.username);
}

function setCurrentUser(record) {
  _currentUser = record;
  DB.setSession(record.username);
  updateHeaderUI();
  showGameSection();
}

function clearCurrentUser() {
  _currentUser = null;
  DB.clearSession();
  updateHeaderUI();
  hideGameSection();
}

function getBal() {
  const u = getCurrentUser();
  return u ? u.balance : 0;
}

function fmtXRS(n) {
  return (typeof n === 'number' ? n : 0)
    .toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:4}) + ' XRS';
}

/* ‚îÄ‚îÄ UI helpers ‚îÄ‚îÄ */
function $$(i) { return document.getElementById(i); }
function setQ(id,v){ $$(id).value=v; }
function half(id){ const e=$$(id); e.value=Math.max(0.01,Math.floor((parseFloat(e.value)||10)/2*100)/100); }
function dbl(id){ const e=$$(id); e.value=Math.round((parseFloat(e.value)||10)*2*100)/100; }
function getBet(id){ return Math.max(0.01, Math.min(getBal()||99999, parseFloat($$(id).value)||10)); }
function setR(id,type,txt){ const e=$$(id); if(!e)return; e.className='rtxt '+type; e.textContent=txt; }
function addH(id,win,lbl){
  const row=$$(id+'H'); if(!row) return;
  const c=document.createElement('span'); c.className='hchip '+(win?'hw':'hl'); c.textContent=lbl;
  row.prepend(c); while(row.children.length>20) row.lastChild.remove();
}

let _tTmr=null;
function toast(msg,color='var(--text)'){
  const t=$$('xpToast');
  t.textContent=msg; t.style.color=color; t.style.borderColor=color;
  t.style.opacity='1'; t.style.transform='translateX(-50%) translateY(0)';
  clearTimeout(_tTmr);
  _tTmr=setTimeout(()=>{ t.style.opacity='0'; t.style.transform='translateX(-50%) translateY(80px)'; },3200);
}

function updateHeaderUI() {
  const u = getCurrentUser();
  if (u) {
    $$('hdrLoginBtn').style.display = 'none';
    $$('hdrUserBtn').style.display = 'flex';
    $$('hdrUsername').textContent = u.username;
    $$('balBar').style.display = 'flex';
    $$('balDisp').textContent = fmtXRS(u.balance);
  } else {
    $$('hdrLoginBtn').style.display = '';
    $$('hdrUserBtn').style.display = 'none';
    $$('balBar').style.display = 'none';
  }
}

function showBal(delta) {
  const u = getCurrentUser(); if (!u) return;
  const el = $$('balDisp'); if (!el) return;
  el.textContent = fmtXRS(u.balance);
  el.style.color = delta > 0 ? 'var(--green)' : delta < 0 ? 'var(--pink)' : 'var(--yellow)';
  setTimeout(() => el.style.color = 'var(--yellow)', 700);
}

function showGameSection() {
  $$('landingSection').style.display = 'none';
  $$('gameSection').classList.add('visible');
}

function hideGameSection() {
  $$('landingSection').style.display = '';
  $$('gameSection').classList.remove('visible');
}

function goHome() {
  closeAllGames();
  if (_currentUser) { showGameSection(); }
  else { hideGameSection(); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AUTH MODAL
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openAuth(tab) {
  switchAuthTab(tab || 'login');
  $$('authOverlay').classList.add('open');
}
function closeAuth() { $$('authOverlay').classList.remove('open'); }

function switchAuthTab(tab) {
  const isLogin = tab === 'login';
  $$('tabLogin').className = 'auth-tab'+(isLogin?' active':'');
  $$('tabRegister').className = 'auth-tab'+(!isLogin?' active':'');
  $$('loginForm').style.display = isLogin ? '' : 'none';
  $$('registerForm').style.display = isLogin ? 'none' : '';
  $$('authTitle').textContent = isLogin ? 'SIGN IN' : 'REGISTER';
  $$('loginError').textContent='';
  $$('regUserError').textContent='';
  $$('regPassError').textContent='';
  $$('regAddrError').textContent='';
}

function doLogin() {
  const user = ($$('loginUser').value||'').trim();
  const pass = $$('loginPass').value||'';
  $$('loginError').textContent='';
  if (!user) { $$('loginError').textContent='Enter your username.'; return; }
  if (!pass) { $$('loginError').textContent='Enter your password.'; return; }
  const r = DB.login(user, pass);
  if (!r.ok) { $$('loginError').textContent = r.error; return; }
  setCurrentUser(r.user);
  closeAuth();
  toast(`Welcome back, ${r.user.username}!`, 'var(--xrs)');
}

function doRegister() {
  const user = ($$('regUser').value||'').trim();
  const pass = $$('regPass').value||'';
  const addr = ($$('regAddr').value||'').trim();
  $$('regUserError').textContent='';
  $$('regPassError').textContent='';
  $$('regAddrError').textContent='';

  let ok = true;
  if (!/^[a-zA-Z0-9_]{3,20}$/.test(user)) {
    $$('regUserError').textContent='3‚Äì20 chars, letters/numbers/underscore only.'; ok=false;
  }
  if (pass.length < 6) {
    $$('regPassError').textContent='Minimum 6 characters.'; ok=false;
  }
  if (addr && !/^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(addr)) {
    $$('regAddrError').textContent='Invalid XRS address format.'; ok=false;
  }
  if (!ok) return;

  const r = DB.register(user, pass, addr);
  if (!r.ok) { $$('regUserError').textContent = r.error; return; }

  // Give welcome bonus
  DB.addBalance(user, 100, { type:'bonus', label:'Welcome Bonus', amount:100, ts:Date.now() });
  const fresh = DB.getUser(user);
  setCurrentUser(fresh);
  closeAuth();
  toast(`Welcome, ${user}! üéâ 100 XRS bonus added!`, 'var(--xrs)');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DASHBOARD MODAL
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openDashboard() {
  showPanel('main');
  const u = getCurrentUser(); if (!u) return;

  // Avatar
  $$('dashAvatar').textContent = u.username[0].toUpperCase();
  $$('dashName').textContent = u.username;
  $$('dashSince').textContent = 'Member since ' + new Date(u.createdAt).toLocaleDateString('en-US',{month:'short',year:'numeric'});
  $$('dashBal').textContent = fmtXRS(u.balance);
  $$('dashWon').textContent = fmtXRS(u.totalWon);
  $$('dashGames').textContent = u.gamesPlayed || 0;

  // Pending check
  const hasPending = (u.depositRequests||[]).some(d=>d.status==='pending')
    || (u.withdrawRequests||[]).some(w=>w.status==='pending');
  $$('pendingBadge').style.display = hasPending ? 'flex' : 'none';

  // Deposit address
  $$('depositAddr').textContent = TREASURY;

  // Pre-fill withdrawal address
  if (u.xrsAddress) $$('withdrawAddr').value = u.xrsAddress;

  // Escrow wallet bar
  renderEscrowBar(u);

  // Transaction history
  renderTxHistory(u);

  $$('dashOverlay').classList.add('open');
}

function renderEscrowBar(u) {
  const dot   = $$('escrowDot');
  const val   = $$('escrowVal');
  const badge = $$('escrowBadge');
  const bar   = $$('escrowBar');
  const inp   = $$('escrowInput');
  const addr  = u.xrsAddress || '';
  const valid = /^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(addr);
  if (valid) {
    dot.className   = 'escrow-dot on';
    val.textContent = addr.slice(0,10) + '‚Ä¶' + addr.slice(-10);
    val.style.color = 'var(--green)';
    badge.className = 'escrow-badge live';
    badge.textContent = '‚õì ON-CHAIN';
    bar.className   = 'escrow-bar';
    bar.style.borderColor = 'rgba(0,255,136,.28)';
  } else {
    dot.className   = 'escrow-dot warn';
    val.textContent = 'Add your XRS address to receive on-chain payouts';
    val.style.color = 'var(--yellow)';
    badge.className = 'escrow-badge off';
    badge.textContent = 'BALANCE ONLY';
    bar.className   = 'escrow-bar warn';
    bar.style.borderColor = '';
  }
  if (inp) inp.value = addr;
}

function toggleEscrowEdit(e) {
  if (e) e.stopPropagation();
  const form = $$('escrowForm');
  const open = form.classList.contains('open');
  form.classList.toggle('open', !open);
  $$('escrowErr').style.display = 'none';
  if (!open) {
    const u = getCurrentUser();
    $$('escrowInput').value = u?.xrsAddress || '';
    setTimeout(() => $$('escrowInput').focus(), 50);
  }
}

function saveEscrowWallet() {
  const errEl = $$('escrowErr');
  const addr  = ($$('escrowInput').value || '').trim();
  errEl.style.display = 'none';
  if (addr && !/^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(addr)) {
    errEl.textContent   = 'Invalid XRS address ‚Äî must be base58, 32‚Äì44 characters.';
    errEl.style.display = 'block'; return;
  }
  const u = getCurrentUser(); if (!u) return;
  const fresh = DB.getUser(u.username);
  fresh.xrsAddress = addr;
  DB.saveUser(fresh); _currentUser = fresh;
  renderEscrowBar(fresh);
  $$('escrowForm').classList.remove('open');
  if ($$('withdrawAddr')) $$('withdrawAddr').value = addr;
  toast(addr
    ? '‚úì Payout wallet saved ‚Äî wins will be airdropped on-chain!'
    : 'Payout wallet removed', addr ? 'var(--green)' : 'var(--dim)');
}

function closeDashboard() { $$('dashOverlay').classList.remove('open'); }

function showPanel(panel) {
  $$('dashMain').style.display = panel==='main' ? '' : 'none';
  $$('depositPanel').className = 'txn-panel' + (panel==='deposit'?' show':'');
  $$('withdrawPanel').className = 'txn-panel' + (panel==='withdraw'?' show':'');
}

function sanitize(str) {
  return String(str||'')
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

function renderTxHistory(u) {
  const list = $$('txList');
  const txs = u.txHistory || [];
  if (!txs.length) { list.innerHTML='<div class="tx-empty">No transactions yet</div>'; return; }
  list.innerHTML = txs.slice(0,20).map(tx => {
    const icons = { deposit:'‚¨á', withdraw:'‚¨Ü', bet:'üé∞', win:'üèÜ', bonus:'üéÅ', faucet:'üö∞', push:'‚Ü©', refund:'‚Ü©' };
    const icon = icons[tx.type] || '‚Ä¢';
    const pos = tx.amount > 0;
    const timeStr = new Date(tx.ts).toLocaleString('en-US',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});
    return `<div class="tx-row">
      <span class="tx-icon">${sanitize(icon)}</span>
      <div class="tx-info">
        <div class="tx-type">${sanitize(tx.label||tx.type.toUpperCase())}</div>
        <div class="tx-time">${sanitize(timeStr)}</div>
      </div>
      <span class="tx-amt ${pos?'pos':tx.amount<0?'neg':'neu'}">${pos?'+':''}${sanitize(fmtXRS(tx.amount))}</span>
    </div>`;
  }).join('');
}

function doLogout() {
  clearCurrentUser();
  closeDashboard();
  toast('Logged out. See you next time!', 'var(--dim)');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DEPOSIT  (2% fee retained by treasury, net credited to player)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setDepAmt(n){ $$('depositAmt').value = n; updateDepositPreview(); }

function updateDepositPreview() {
  const amt = parseFloat($$('depositAmt').value)||0;
  const prev = $$('depositPreview');
  if (amt <= 0) { prev.style.display='none'; return; }
  const fee = +(amt * FEE_RATE).toFixed(4);
  const net = +(amt - fee).toFixed(4);
  prev.style.display = '';
  $$('depGross').textContent = fmtXRS(amt);
  $$('depFee').textContent   = '-' + fmtXRS(fee);
  $$('depNet').textContent   = fmtXRS(net);
}

function submitDeposit() {
  const u = getCurrentUser(); if (!u) return;
  const gross = parseFloat($$('depositAmt').value)||0;
  const txid  = ($$('depositTxid').value||'').trim();
  $$('depositError').textContent = '';
  if (gross < 1) { $$('depositError').textContent='Minimum deposit is 1 XRS.'; return; }

  const fee = +(gross * FEE_RATE).toFixed(4);
  const net = +(gross - fee).toFixed(4);

  const req = { id:'dep-'+Date.now(), gross, fee, net, txid, status:'pending', ts:Date.now() };
  const fresh = DB.getUser(u.username);
  fresh.depositRequests = fresh.depositRequests || [];
  fresh.depositRequests.unshift(req);
  fresh.txHistory = fresh.txHistory || [];
  fresh.txHistory.unshift({
    type:'deposit',
    label:`Deposit Request ‚Äî ${fmtXRS(gross)} gross (fee: ${fmtXRS(fee)})`,
    amount: 0, status:'pending', req:req.id, ts:Date.now()
  });
  DB.saveUser(fresh);
  _currentUser = fresh;

  toast('‚úì Deposit request submitted!', 'var(--green)');
  $$('depositAmt').value=''; $$('depositTxid').value='';
  $$('depositPreview').style.display='none';
  showPanel('main');
  openDashboard();
}

/* Called by admin/system once a deposit is confirmed on-chain.
   Credits net amount (after 2% fee) to the player balance.        */
function confirmDeposit(username, reqId) {
  const u = DB.getUser(username); if (!u) return false;
  const req = (u.depositRequests||[]).find(r=>r.id===reqId);
  if (!req || req.status!=='pending') return false;
  req.status = 'confirmed';
  const net = req.net || +(req.gross*(1-FEE_RATE)).toFixed(4);
  // Update history entry
  const tx = (u.txHistory||[]).find(t=>t.req===reqId);
  if (tx) { tx.label=`Deposit Confirmed ‚Äî received ${fmtXRS(net)}`; tx.amount=net; tx.status='confirmed'; }
  DB.addBalance(username, net, {
    type:'deposit', label:`Deposit +${fmtXRS(net)} (fee ${FEE_RATE*100}% deducted)`, amount:net, ts:Date.now()
  });
  if (_currentUser?.username?.toLowerCase()===username.toLowerCase()) {
    _currentUser = DB.getUser(username); updateHeaderUI();
  }
  return true;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WITHDRAW  (2% fee to treasury, net auto-sent to player's XRS address)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setWdrAmt(mode) {
  const u = getCurrentUser(); if (!u) return;
  const bal = u.balance;
  if (mode === 'half') $$('withdrawAmt').value = Math.floor(bal / 2 * 100) / 100;
  else $$('withdrawAmt').value = bal;
  updateWithdrawPreview();
}

function updateWithdrawPreview() {
  const amt  = parseFloat($$('withdrawAmt').value) || 0;
  const prev = $$('withdrawPreview');
  if (amt <= 0) { prev.style.display = 'none'; return; }
  const fee = +(amt * FEE_RATE).toFixed(4);
  const net = +(amt - fee).toFixed(4);
  prev.style.display = '';
  $$('wdrGross').textContent = fmtXRS(amt);
  $$('wdrFee').textContent   = '-' + fmtXRS(fee);
  $$('wdrNet').textContent   = fmtXRS(net);
}

async function submitWithdraw() {
  const u = getCurrentUser(); if (!u) return;
  const addr  = ($$('withdrawAddr').value || '').trim();
  const gross = parseFloat($$('withdrawAmt').value) || 0;
  $$('withdrawAddrErr').textContent = '';
  $$('withdrawAmtErr').textContent  = '';
  $$('withdrawError').textContent   = '';

  let ok = true;
  if (!/^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(addr)) {
    $$('withdrawAddrErr').textContent = 'Enter a valid XRS address.'; ok = false;
  }
  if (gross < 10) {
    $$('withdrawAmtErr').textContent = 'Minimum withdrawal is 10 XRS.'; ok = false;
  }
  if (gross > u.balance) {
    $$('withdrawAmtErr').textContent = `Insufficient balance (${fmtXRS(u.balance)}).`; ok = false;
  }
  if (!ok) return;

  const fee = +(gross * FEE_RATE).toFixed(4);
  const net = +(gross - fee).toFixed(4);
  const btn = $$('withdrawBtn');
  btn.disabled = true;
  btn.textContent = '‚è≥ Sending\u2026';

  try {
    const fresh = DB.getUser(u.username);
    fresh.balance = Math.max(0, +(fresh.balance - gross).toFixed(4));
    if (addr) fresh.xrsAddress = addr;

    const reqId = 'wdr-' + Date.now();
    fresh.withdrawRequests = fresh.withdrawRequests || [];
    fresh.withdrawRequests.unshift({ id:reqId, gross, fee, net, address:addr, status:'processing', ts:Date.now() });
    fresh.txHistory = fresh.txHistory || [];
    fresh.txHistory.unshift({
      type:'withdraw',
      label:`Withdrawal sending ${fmtXRS(net)} \u2192 \u2026${addr.slice(-6)} (fee ${fmtXRS(fee)})`,
      amount:-gross, status:'processing', reqId, ts:Date.now()
    });
    DB.saveUser(fresh);
    _currentUser = fresh;
    updateHeaderUI();
    showBal(-gross);

    closeDashboard();
    toast('\u23f3 Sending ' + fmtXRS(net) + ' to your wallet\u2026', 'var(--yellow)');

    const result = await autoSend(addr, net);
    const u2   = DB.getUser(u.username);
    const req  = (u2.withdrawRequests||[]).find(r=>r.id===reqId);
    const hist = (u2.txHistory||[]).find(t=>t.reqId===reqId);

    if (result.ok) {
      if (req)  { req.status='sent'; req.signature=result.signature; }
      if (hist) { hist.status='sent'; hist.label=`Withdrawal sent ${fmtXRS(net)} \u2192 \u2026${addr.slice(-6)} (fee ${fmtXRS(fee)})`; hist.sig=result.signature; }
      DB.saveUser(u2);
      _currentUser = DB.getUser(u.username);
      toast(`\u2713 ${fmtXRS(net)} sent! Tx: ${(result.signature||'').slice(0,12)}\u2026`, 'var(--green)');
    } else {
      u2.balance = +(u2.balance + gross).toFixed(4);
      if (req)  { req.status='failed'; req.error=result.error; }
      if (hist) { hist.status='failed'; hist.label=`Withdrawal FAILED \u2014 refunded ${fmtXRS(gross)} (node error)`; hist.amount=0; }
      u2.txHistory = u2.txHistory||[];
      u2.txHistory.unshift({ type:'refund', label:`Withdrawal refund \u2014 ${fmtXRS(gross)}`, amount:gross, ts:Date.now() });
      DB.saveUser(u2);
      _currentUser = DB.getUser(u.username);
      updateHeaderUI();
      showBal(gross);
      toast('\u26a0 Send failed \u2014 balance refunded. Try again.', 'var(--pink)');
    }

    $$('withdrawAmt').value = '';
    if ($$('withdrawPreview')) $$('withdrawPreview').style.display = 'none';

  } catch(err) {
    toast('\u26a0 Unexpected error: ' + err.message, 'var(--pink)');
    console.error('[withdraw]', err);
  } finally {
    const b = $$('withdrawBtn');
    if (b) { b.disabled = false; b.textContent = 'WITHDRAW NOW'; }
  }
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FAUCET CLAIM
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function claimFaucet() {
  const u = getCurrentUser(); if (!u) return;
  const fresh = DB.getUser(u.username);
  const now = Date.now();
  const cooldownMs = FAUCET_COOLDOWN_H * 3600 * 1000;
  const last = fresh.faucetLastClaim || 0;

  if (now - last < cooldownMs) {
    const remaining = Math.ceil((cooldownMs - (now-last)) / 3600000);
    toast(`‚è∞ Faucet: come back in ${remaining}h`, 'var(--yellow)');
    closeDashboard();
    return;
  }

  DB.addBalance(u.username, FAUCET_AMOUNT, { type:'faucet', label:'Daily Faucet Claim', amount:FAUCET_AMOUNT, ts:now });
  const u2 = DB.getUser(u.username);
  u2.faucetLastClaim = now;
  DB.saveUser(u2);
  _currentUser = u2;
  updateHeaderUI();

  toast(`üö∞ ${FAUCET_AMOUNT} XRS claimed!`, 'var(--blue)');
  closeDashboard();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GAME BALANCE OPS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function placeBet(amount) {
  const u = getCurrentUser(); if (!u) throw new Error('Not logged in');
  if (amount > u.balance) throw new Error(`Insufficient balance ‚Äî have ${fmtXRS(u.balance)}`);
  DB.addBalance(u.username, -amount, { type:'bet', label:'Bet Placed', amount:-amount, ts:Date.now() });
  DB.incGames(u.username);
  _currentUser = DB.getUser(u.username);
  showBal(-amount);
}

function settleWin(amount, label) {
  const u = getCurrentUser(); if (!u) return;
  // fires escrow airdrop on-chain + credits balance
  escrowPayout(u.username, amount, label || 'Win');
  _currentUser = DB.getUser(u.username);
  showBal(amount);
}

function settlePush(amount) {
  const u = getCurrentUser(); if (!u) return;
  DB.addBalance(u.username, amount, { type:'push', label:'Push ‚Äî Bet Returned', amount:+amount, ts:Date.now() });
  _currentUser = DB.getUser(u.username);
  showBal(0);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODAL HELPERS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function bgClose(e, id) { if (e.target === $$(id)) { if(id==='authOverlay') closeAuth(); else closeDashboard(); } }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TICKER
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function initTicker(){
  const names=['ShadowX','LuckyKat','Bolt99','NeonRider','ZeroEdge','FairPlay','HighRoller','DiamondK','NightOwl','Starfall'];
  const games=['Crash','Dice','Roulette','Blackjack'];
  const items=[];
  for(let i=0;i<14;i++){
    const w=Math.random()>.45, a=(Math.random()*490+6).toFixed(2);
    items.push(`<span class="tick"><span class="tu">${sanitize(names[i%names.length])}</span><span class="tg">[${sanitize(games[i%games.length])}]</span><span class="${w?'tw':'tl'}">${w?'+':'-'}${a} XRS</span></span>`);
  }
  const el=$$('ttrack');
  if(el) el.innerHTML=items.join('')+items.join('');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAVIGATION
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function closeAllGames(){
  if(crashRunning) crashCancelBet();
  document.querySelectorAll('.arena').forEach(a=>a.classList.remove('on'));
  document.querySelectorAll('.gcard').forEach(c=>c.classList.remove('active'));
}
function openGame(g){
  if(!getCurrentUser()){ toast('Sign in to play!','var(--pink)'); openAuth(); return; }
  closeAllGames();
  $$('arena-'+g).classList.add('on');
  $$('card-'+g).classList.add('active');
  setTimeout(()=>$$('arena-'+g).scrollIntoView({behavior:'smooth',block:'nearest'}),60);
  if(g==='crash') initCrashCanvas();
  if(g==='dice') refreshDP();
}
function closeGame(){
  if(crashRunning) crashCancelBet();
  document.querySelectorAll('.arena').forEach(a=>a.classList.remove('on'));
  document.querySelectorAll('.gcard').forEach(c=>c.classList.remove('active'));
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üöÄ CRASH
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let crashRunning=false,crashCashedOut=false,crashBetAmt=0;
let crashCrashAt=1,crashMult=1,crashT0=0,crashRaf=null,crashPts=[];

function genCrashAt(){ return Math.random()<.05?1.00:Math.max(1.01,.99/(1-Math.random())); }
function initCrashCanvas(){
  const c=$$('crashCanvas');
  const wrap=c.parentElement;
  const setSize=()=>{
    const r=wrap.getBoundingClientRect();
    c.width=Math.max(200,Math.round(r.width));
    c.height=200;
    drawCrashFrame();
  };
  setSize();
  if(window._crashRO) window._crashRO.disconnect();
  window._crashRO=new ResizeObserver(setSize);
  window._crashRO.observe(wrap);
}
function drawCrashFrame(){
  const c=$$('crashCanvas'); if(!c) return;
  const ctx=c.getContext('2d'),W=c.width,H=c.height;
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='rgba(200,255,0,.04)'; ctx.lineWidth=1;
  for(let i=1;i<4;i++){
    ctx.beginPath();ctx.moveTo(0,H*i/4);ctx.lineTo(W,H*i/4);ctx.stroke();
    ctx.beginPath();ctx.moveTo(W*i/4,0);ctx.lineTo(W*i/4,H);ctx.stroke();
  }
  if(crashPts.length<2) return;
  const maxT=crashPts[crashPts.length-1][0]||1, maxM=Math.max(2,crashMult*1.15);
  const crashed=!crashRunning&&crashMult>1, col=crashed?'#ff2d78':'#c8ff00';
  ctx.strokeStyle=col; ctx.lineWidth=2.5; ctx.shadowColor=col; ctx.shadowBlur=8;
  ctx.beginPath();
  crashPts.forEach(([t,m],i)=>{ const x=(t/maxT)*W,y=H-(m/maxM)*(H*.86); i===0?ctx.moveTo(x,y):ctx.lineTo(x,y); });
  ctx.stroke(); ctx.shadowBlur=0;
  const [lt,lm]=crashPts[crashPts.length-1], lx=(lt/maxT)*W;
  const g=ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,crashed?'rgba(255,45,120,.18)':'rgba(200,255,0,.12)'); g.addColorStop(1,'transparent');
  ctx.fillStyle=g; ctx.beginPath();
  crashPts.forEach(([t,m],i)=>{ const x=(t/maxT)*W,y=H-(m/maxM)*(H*.86); i===0?ctx.moveTo(x,y):ctx.lineTo(x,y); });
  ctx.lineTo(lx,H); ctx.lineTo(0,H); ctx.closePath(); ctx.fill();
}

function crashAction(){
  const btn=$$('crashBtn');
  if(!crashRunning){
    if(!getCurrentUser()){ openAuth(); return; }
    const bet=getBet('cBet');
    try { placeBet(bet); }
    catch(e){ toast(e.message,'var(--pink)'); return; }
    crashBetAmt=bet; crashCashedOut=false; crashRunning=true;
    crashCrashAt=genCrashAt(); crashMult=1; crashPts=[]; crashT0=performance.now();
    btn.textContent='üí∞ Cash Out'; btn.classList.add('cashout');
    $$('crashStat').textContent='LIVE ‚Äî Cash out anytime!';
    setR('crashRes','neutral','Running‚Ä¶');
    crashRaf=requestAnimationFrame(crashLoop);
  } else if(!crashCashedOut){
    crashCashedOut=true;
    const won=parseFloat((crashBetAmt*crashMult).toFixed(4));
    settleWin(won,'Crash Cash Out √ó'+crashMult.toFixed(2));
    setR('crashRes','win','Cashed out at '+crashMult.toFixed(2)+'√ó ‚Äî Won '+fmtXRS(won)+'!');
    addH('crash',true,crashMult.toFixed(2)+'√ó');
    toast('üèÜ Won '+fmtXRS(won),'var(--green)');
    endCrashRound('Cashed out ‚Äî Place a new bet');
  }
}

function crashLoop(){
  const elapsed=performance.now()-crashT0;
  crashMult=parseFloat(Math.exp(0.000065*elapsed).toFixed(4));
  crashPts.push([elapsed,crashMult]);
  const me=$$('crashMult');
  me.textContent=crashMult.toFixed(2)+'√ó';
  me.style.color=crashMult<2?'var(--green)':crashMult<5?'var(--yellow)':'var(--pink)';
  if(!crashCashedOut) setR('crashRes','neutral','Running‚Ä¶ '+crashMult.toFixed(2)+'√ó');
  drawCrashFrame();
  if(crashMult>=crashCrashAt){
    if(!crashCashedOut){
      setR('crashRes','lose','Crashed at '+crashMult.toFixed(2)+'√ó ‚Äî Lost '+fmtXRS(crashBetAmt));
      addH('crash',false,crashMult.toFixed(2)+'√ó');
      toast('üí• Crashed at '+crashMult.toFixed(2)+'√ó','var(--pink)');
    }
    $$('crashMult').style.color='var(--pink)'; drawCrashFrame();
    endCrashRound('Crashed at '+crashMult.toFixed(2)+'√ó');
  } else { crashRaf=requestAnimationFrame(crashLoop); }
}

function endCrashRound(s){
  crashRunning=false; cancelAnimationFrame(crashRaf); crashRaf=null;
  $$('crashStat').textContent=s;
  const btn=$$('crashBtn'); btn.textContent='Place Bet'; btn.classList.remove('cashout');
  setTimeout(()=>{ crashPts=[];crashMult=1;$$('crashMult').textContent='1.00√ó';$$('crashMult').style.color='var(--green)';$$('crashStat').textContent='Place a bet to start';drawCrashFrame(); },2200);
}
function crashCancelBet(){ if(!crashRunning) return; cancelAnimationFrame(crashRaf); crashRunning=false; settlePush(crashBetAmt); endCrashRound('Round cancelled'); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üé≤ DICE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const FACES=['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
function calcDicePayout(mode,tgt){
  let wins=0;
  for(let a=1;a<=6;a++) for(let b=1;b<=6;b++){ const s=a+b; if(mode==='exact'&&s===tgt)wins++; else if(mode==='over'&&s>tgt)wins++; else if(mode==='under'&&s<tgt)wins++; }
  return wins===0?0:Math.round(3600/wins)/100;
}
function refreshDP(){ const m=$$('diceMode').value,t=parseInt($$('diceTgt').value)||7; $$('dpayout').textContent='Payout: '+calcDicePayout(m,t)+'√ó'; }

function rollDice(){
  if(!getCurrentUser()){ openAuth(); return; }
  const bet=getBet('dBet');
  const btn=$$('diceBtn'); btn.disabled=true;
  try { placeBet(bet); } catch(e){ btn.disabled=false; toast(e.message,'var(--pink)'); return; }
  const d1=$$('die1'),d2=$$('die2'); d1.classList.add('r'); d2.classList.add('r');
  let ticks=0;
  const iv=setInterval(()=>{
    d1.textContent=FACES[Math.floor(Math.random()*6)]; d2.textContent=FACES[Math.floor(Math.random()*6)];
    if(++ticks>=10){
      clearInterval(iv); d1.classList.remove('r'); d2.classList.remove('r');
      const v1=Math.floor(Math.random()*6)+1,v2=Math.floor(Math.random()*6)+1;
      d1.textContent=FACES[v1-1]; d2.textContent=FACES[v2-1];
      const total=v1+v2; $$('dtotal').textContent='Total: '+total;
      const mode=$$('diceMode').value,tgt=parseInt($$('diceTgt').value)||7;
      let win=false;
      if(mode==='exact') win=total===tgt; else if(mode==='over') win=total>tgt; else win=total<tgt;
      const mult=calcDicePayout(mode,tgt);
      if(win){ const won=parseFloat((bet*mult).toFixed(4)); settleWin(won,'Dice Win √ó'+mult); setR('diceRes','win','Rolled '+total+' ‚Äî Won '+fmtXRS(won)+' ('+mult+'√ó)!'); addH('dice',true,total); toast('üé≤ Won '+fmtXRS(won),'var(--green)'); }
      else { setR('diceRes','lose','Rolled '+total+' ‚Äî Lost '+fmtXRS(bet)); addH('dice',false,total); }
      btn.disabled=false;
    }
  },65);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üé° ROULETTE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const REDS=new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
let obType=null,wheelDeg=0;
function pickOB(t){ obType=t; document.querySelectorAll('.bchip').forEach(c=>c.classList.remove('sel')); $$('ob-'+t).classList.add('sel'); $$('rPick').value=''; }
function clearOB(){ obType=null; document.querySelectorAll('.bchip').forEach(c=>c.classList.remove('sel')); }

function spinR(){
  if(!getCurrentUser()){ openAuth(); return; }
  const bet=getBet('rBet');
  const ps=$$('rPick').value,pickedNum=ps!==''?parseInt(ps):null;
  if(obType===null&&pickedNum===null){ setR('rRes','neutral','Select a bet type first!'); return; }
  if(pickedNum!==null&&(pickedNum<0||pickedNum>36)){ setR('rRes','neutral','Number must be 0‚Äì36!'); return; }
  const btn=$$('rBtn'); btn.disabled=true;
  try { placeBet(bet); } catch(e){ btn.disabled=false; toast(e.message,'var(--pink)'); return; }
  const result=Math.floor(Math.random()*37);
  const spins=4*360,slotDeg=360/37,diff=((360-wheelDeg%360+result*slotDeg)%360)||360;
  wheelDeg+=spins+diff; $$('rWheel').style.transform='rotate('+wheelDeg+'deg)';
  setTimeout(()=>{
    const ne=$$('rNum'); ne.textContent=result; ne.style.color=result===0?'var(--green)':REDS.has(result)?'#ff6060':'#ccc';
    let win=false,payout=0;
    if(pickedNum!==null){ win=result===pickedNum; payout=35; }
    else {
      const isR=REDS.has(result)&&result!==0,isB=!REDS.has(result)&&result!==0;
      if(obType==='red'){win=isR;payout=1;} else if(obType==='black'){win=isB;payout=1;}
      else if(obType==='even'){win=result>0&&result%2===0;payout=1;} else if(obType==='odd'){win=result>0&&result%2===1;payout=1;}
      else if(obType==='low'){win=result>=1&&result<=18;payout=1;} else if(obType==='high'){win=result>=19&&result<=36;payout=1;}
    }
    if(win){ const won=parseFloat((bet*(payout+1)).toFixed(4)); settleWin(won,'Roulette Win √ó'+(payout+1)); setR('rRes','win',''+result+' ‚Äî Won '+fmtXRS(won)+'!'); addH('r',true,result); toast('üé° Won '+fmtXRS(won),'var(--green)'); }
    else { setR('rRes','lose',''+result+' ‚Äî Lost '+fmtXRS(bet)); addH('r',false,result); }
    btn.disabled=false;
  },3300);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üÉè BLACKJACK
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const SUITS=['‚ô†','‚ô•','‚ô¶','‚ô£'],RANKS=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
let bjDeck=[],bjP=[],bjD=[],bjCurBet=0;
function mkDeck(){ bjDeck=[]; for(const s of SUITS) for(const r of RANKS) bjDeck.push({r,s}); for(let i=bjDeck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1));[bjDeck[i],bjDeck[j]]=[bjDeck[j],bjDeck[i]]; } }
function pop(){ return bjDeck.pop(); }
function cval(c){ if(c.r==='A') return 11; if(['J','Q','K'].includes(c.r)) return 10; return +c.r; }
function score(h){ let s=0,a=0; h.forEach(c=>{s+=cval(c);if(c.r==='A')a++;}); while(s>21&&a>0){s-=10;a--;} return s; }
function mkCard(c,fd=false){
  if(fd) return '<div class="card back"></div>';
  const red=['‚ô•','‚ô¶'].includes(c.s);
  return `<div class="card${red?' red':''}">`+`<div>${c.r}<div style="font-size:.62rem">${c.s}</div></div>`+`<div style="align-self:flex-end;transform:rotate(180deg)">${c.r}<div style="font-size:.62rem">${c.s}</div></div></div>`;
}
function renderBJ(revD=false){
  $$('pHand').innerHTML=bjP.map(c=>mkCard(c)).join(''); $$('dHand').innerHTML=bjD.map((c,i)=>mkCard(c,i===1&&!revD)).join('');
  $$('pScore').textContent=score(bjP); $$('dScore').textContent=revD?score(bjD):'?';
  $$('bjBetShow').textContent='Current bet: '+fmtXRS(bjCurBet);
}
function setBJbtns(inPlay){ $$('bjDeal').disabled=inPlay; $$('bjHit').disabled=!inPlay; $$('bjStand').disabled=!inPlay; $$('bjDbl').disabled=!inPlay||bjP.length!==2; }
function bjDeal(){
  if(!getCurrentUser()){ openAuth(); return; }
  const bet=getBet('bjBet');
  try { placeBet(bet); } catch(e){ toast(e.message,'var(--pink)'); return; }
  bjCurBet=bet; mkDeck(); bjP=[pop(),pop()]; bjD=[pop(),pop()];
  renderBJ(false); setBJbtns(true); setR('bjRes','neutral','Hit, Stand or Double');
  if(score(bjP)===21) bjStand();
}
function bjHit(){ bjP.push(pop()); renderBJ(false); $$('bjDbl').disabled=true; if(score(bjP)>21){ renderBJ(true); setR('bjRes','lose','Bust! Lost '+fmtXRS(bjCurBet)); addH('bj',false,'BUST'); setBJbtns(false); } }
function bjDouble(){
  if(bjCurBet>getBal()){ setR('bjRes','neutral','Not enough to double!'); return; }
  try { placeBet(bjCurBet); } catch(e){ toast(e.message,'var(--pink)'); return; }
  bjCurBet*=2; bjP.push(pop()); renderBJ(false);
  if(score(bjP)>21){ renderBJ(true); setR('bjRes','lose','Bust after double! Lost '+fmtXRS(bjCurBet)); addH('bj',false,'BUST'); setBJbtns(false); }
  else bjStand();
}
function bjStand(){
  setBJbtns(false); while(score(bjD)<17) bjD.push(pop()); renderBJ(true);
  const ps=score(bjP),ds=score(bjD),natBJ=ps===21&&bjP.length===2&&!(ds===21&&bjD.length===2);
  let win=false,msg='';
  if(natBJ){ const won=parseFloat((bjCurBet*2.5).toFixed(4)); settleWin(won,'Blackjack! √ó2.5'); win=true; msg='Blackjack! Won '+fmtXRS(won)+' (3:2)'; toast('üÉè Blackjack! +'+fmtXRS(won),'var(--green)'); }
  else if(ps>21){ msg='Bust ‚Äî Lost '+fmtXRS(bjCurBet); }
  else if(ds>21){ const won=bjCurBet*2; settleWin(won,'Blackjack Win'); win=true; msg='Dealer busts! Won '+fmtXRS(bjCurBet); toast('üÉè Won '+fmtXRS(bjCurBet),'var(--green)'); }
  else if(ps>ds){ const won=bjCurBet*2; settleWin(won,'Blackjack Win'); win=true; msg='You win! '+ps+' vs '+ds+' ‚Äî Won '+fmtXRS(bjCurBet); toast('üÉè Won '+fmtXRS(bjCurBet),'var(--green)'); }
  else if(ps===ds){ settlePush(bjCurBet); msg='Push ('+ps+') ‚Äî Bet returned'; }
  else { msg='Dealer wins '+ds+' vs '+ps+' ‚Äî Lost '+fmtXRS(bjCurBet); }
  setR('bjRes',win?'win':ps===ds?'neutral':'lose',msg); addH('bj',win,ps+'/'+ds);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.addEventListener('DOMContentLoaded',()=>{
  try {
    initTicker();
    refreshDP();
    // Restore session if previously logged in
    const savedUser = DB.getSession();
    if (savedUser) {
      const u = DB.getUser(savedUser);
      if (u) { _currentUser = u; updateHeaderUI(); showGameSection(); }
    }
    // Enter key in login / register
    document.getElementById('loginPass').addEventListener('keydown', e=>{ if(e.key==='Enter') doLogin(); });
    document.getElementById('loginUser').addEventListener('keydown', e=>{ if(e.key==='Enter') doLogin(); });
    document.getElementById('regUser').addEventListener('keydown',  e=>{ if(e.key==='Enter') doRegister(); });
    document.getElementById('regPass').addEventListener('keydown',  e=>{ if(e.key==='Enter') doRegister(); });
  } catch(e) {
    console.error('[XERIS.PLAY] Init error:', e);
  }
});

async function detectProvider() {
  const keys = Object.keys(window).filter(k => 
    k.toLowerCase().includes('xeris') || 
    k.toLowerCase().includes('solana') || 
    k.toLowerCase().includes('wallet') ||
    k.toLowerCase().includes('xrs') ||
    k.toLowerCase().includes('phantom')
  );
  return keys;
}

async function connectXerisWallet() {
  // First detect what's available
  const detected = await detectProvider();
  console.log('Detected wallet providers:', detected);
  
  const provider = window.xeris || window.xrs || window.solana || 
                   window.XerisWallet || window.xerisWallet ||
                   (window.phantom && window.phantom.solana);
  try {
    const provider = window.xeris || window.solana;
    if (!provider) {
      // Fallback: show modal asking to open in Xeris Wallet browser
      const modal = document.createElement('div');
      modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:9999;display:flex;align-items:center;justify-content:center;padding:16px;';
      modal.innerHTML = '<div style="background:#0d1428;border:1px solid #c8ff00;border-radius:16px;padding:28px;max-width:380px;width:100%;color:#fff;text-align:center;"><div style="font-size:48px;margin-bottom:12px;">üì±</div><h3 style="color:#c8ff00;margin:0 0 12px;">Open in Xeris Wallet</h3><p style="color:#888;margin:0 0 20px;font-size:14px;">Open this site inside the Xeris Wallet app browser to connect your wallet directly.</p><p style="background:#111;padding:10px;border-radius:8px;font-size:12px;word-break:break-all;color:#c8ff00;margin:0 0 16px;">xeris-play-production.up.railway.app</p><button onclick="navigator.clipboard.writeText('xeris-play-production.up.railway.app').then(()=>alert('Copied!'))" style="width:100%;padding:12px;background:#c8ff00;color:#000;border:none;border-radius:8px;font-weight:700;cursor:pointer;margin-bottom:8px;">Copy Link</button><button onclick="this.closest('div[style]').remove()" style="width:100%;padding:10px;background:transparent;border:1px solid #333;color:#888;border-radius:8px;cursor:pointer;">Close</button></div>';
      document.body.appendChild(modal);
      modal.addEventListener('click', e => { if(e.target===modal) modal.remove(); });
      return;
    }
    const resp = await provider.connect();
    const address = resp.publicKey.toString();
    let u = DB.getUser(address);
    if (!u) {
      u = { username: address.slice(0,6)+'...'+address.slice(-4), passwordHash:'',
        balance:0, payoutWallet:address, walletConnected:true,
        txHistory:[], depositRequests:[], totalWon:0, gamesPlayed:0, createdAt:Date.now() };
      DB.saveUser(u);
    }
    try {
      const r = await fetch('/api/balance/'+address);
      const d = await r.json();
      if (d.balance > 0) { u.balance = d.balance/1e9; DB.saveUser(u); }
    } catch(e){}
    _currentUser = DB.getUser(address);
    DB.setSession(address);
    updateHeaderUI();
    showGameSection();
    toast('‚úì Wallet connected!', 'var(--green)');
  } catch(e) {
    toast('Connection failed: '+e.message, 'var(--pink)');
  }
}
</script>
<!-- xeris.play v2.2 ‚Äî 4-game production build ¬∑ 2026-02-22 -->

</body>
</html>

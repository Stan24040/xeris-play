<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>XERIS.PLAY</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet"/>
<style>
:root{--bg:#060a0f;--bg2:#0c1018;--bg3:#111827;--green:#a8ff3e;--green2:#7ed321;--gold:#f5c842;--red:#ff4d6d;--blue:#38bdf8;--text:#e8edf2;--muted:#6b7a8d;--border:#1e2d3d;--card:#0f1923;--r:12px;}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:Space Grotesk,sans-serif;min-height:100vh;overflow-x:hidden;}
body::before{content:"";position:fixed;inset:0;background:radial-gradient(ellipse 80% 60% at 50% -10%,rgba(168,255,62,.07),transparent);pointer-events:none;z-index:0;}
nav{position:sticky;top:0;z-index:100;background:rgba(6,10,15,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 20px;display:flex;align-items:center;justify-content:space-between;height:60px;}
.logo{font-size:1.3rem;font-weight:700;letter-spacing:2px;}.logo span{color:var(--green);}
.nav-right{display:flex;align-items:center;gap:10px;}
#balDisp{font-family:JetBrains Mono,monospace;font-size:.82rem;color:var(--green);background:rgba(168,255,62,.1);padding:6px 12px;border-radius:20px;display:none;}
#conBtn{background:var(--green);color:#000;border:none;padding:8px 18px;border-radius:8px;font-weight:700;font-size:.85rem;cursor:pointer;transition:all .2s;}
#conBtn:hover{background:var(--green2);}
#conBtn.on{background:transparent;color:var(--green);border:1px solid var(--green);font-size:.75rem;}
.hero{text-align:center;padding:60px 20px 40px;position:relative;z-index:1;}
.badge{display:inline-block;background:rgba(168,255,62,.12);color:var(--green);font-size:.72rem;letter-spacing:2px;padding:5px 14px;border-radius:20px;margin-bottom:20px;border:1px solid rgba(168,255,62,.2);}
.hero h1{font-size:clamp(2rem,8vw,3.5rem);font-weight:700;line-height:1.1;margin-bottom:16px;}
.hero h1 span{color:var(--green);}
.hero p{color:var(--muted);max-width:480px;margin:0 auto 30px;}
.stats{display:flex;gap:24px;justify-content:center;flex-wrap:wrap;}
.stat-v{font-family:JetBrains Mono,monospace;font-size:1.2rem;font-weight:700;color:var(--green);}
.stat-l{font-size:.72rem;color:var(--muted);letter-spacing:1px;margin-top:2px;}
.sec{padding:20px;max-width:900px;margin:0 auto;position:relative;z-index:1;}
.sec-t{font-size:.75rem;letter-spacing:2px;color:var(--muted);margin-bottom:16px;text-transform:uppercase;}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;}
@media(min-width:600px){.grid{grid-template-columns:repeat(4,1fr);}}
.gc{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:20px 16px;cursor:pointer;transition:all .2s;text-align:center;}
.gc:hover,.gc.on{border-color:var(--green);transform:translateY(-2px);box-shadow:0 8px 24px rgba(168,255,62,.1);}
.gc.on{background:rgba(168,255,62,.06);}
.gi{font-size:2rem;margin-bottom:8px;}.gn{font-weight:700;font-size:.9rem;letter-spacing:.5px;margin-bottom:4px;}.gd{font-size:.72rem;color:var(--muted);}
#gPanel{display:none;background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:24px;margin-top:16px;}
.ph{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.pt{font-size:1.1rem;font-weight:700;}
.cb{background:none;border:1px solid var(--border);color:var(--muted);padding:6px 12px;border-radius:6px;cursor:pointer;font-size:.8rem;}
.cb:hover{border-color:var(--red);color:var(--red);}
.ir{display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap;}
.ig{flex:1;min-width:120px;}
.il{font-size:.72rem;color:var(--muted);margin-bottom:6px;letter-spacing:.5px;display:block;}
input,select{width:100%;background:#0a1018;border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:8px;font-family:Space Grotesk,sans-serif;font-size:.9rem;outline:none;transition:.15s;}
input:focus,select:focus{border-color:var(--green);}
select option{background:#111827;}
.qa-row{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap;align-items:center;}
.qa{background:#111827;border:1px solid var(--border);color:var(--muted);padding:5px 10px;border-radius:6px;cursor:pointer;font-size:.78rem;transition:.15s;}
.qa:hover{border-color:var(--green);color:var(--green);}
.cdisp{background:#0a1018;border-radius:10px;padding:30px;text-align:center;margin-bottom:16px;border:1px solid var(--border);}
.cm{font-family:JetBrains Mono,monospace;font-size:3.5rem;font-weight:700;color:var(--green);transition:color .3s;}
.cm.crash{color:var(--red);}.cm.win{color:var(--gold);}
.cl{font-size:.75rem;color:var(--muted);margin-top:4px;letter-spacing:1px;}
.ch{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;}
.chi{padding:3px 8px;border-radius:4px;font-family:JetBrains Mono,monospace;font-size:.72rem;font-weight:700;}
.chi.lo{background:rgba(255,77,109,.15);color:var(--red);}.chi.mi{background:rgba(168,255,62,.15);color:var(--green);}.chi.hi{background:rgba(245,200,66,.15);color:var(--gold);}
.ddisp{display:flex;align-items:center;gap:20px;background:#0a1018;border-radius:10px;padding:20px;margin-bottom:16px;border:1px solid var(--border);}
.dr{font-family:JetBrains Mono,monospace;font-size:3rem;font-weight:700;}
.rdisp{background:#0a1018;border-radius:10px;padding:20px;margin-bottom:16px;border:1px solid var(--border);text-align:center;}
.rr{font-family:JetBrains Mono,monospace;font-size:3rem;font-weight:700;}
.rr.red{color:var(--red);}.rr.black{color:var(--text);}.rr.green{color:var(--green);}
.rbets{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:14px;}
.rb{background:#0a1018;border:1px solid var(--border);padding:8px;border-radius:8px;cursor:pointer;text-align:center;transition:.15s;}
.rb:hover,.rb.on{border-color:var(--green);background:rgba(168,255,62,.08);color:var(--green);}
.rbn{font-size:.8rem;font-weight:600;}.rbo{font-size:.7rem;color:var(--muted);}
.bjt{background:#0a1018;border-radius:10px;padding:20px;margin-bottom:16px;border:1px solid var(--border);}
.bjhl{font-size:.72rem;color:var(--muted);letter-spacing:1px;margin-bottom:8px;}
.cards{display:flex;gap:8px;flex-wrap:wrap;min-height:60px;margin-bottom:12px;}
.card{background:#1a2535;border:1px solid var(--border);border-radius:6px;padding:8px 10px;font-family:JetBrains Mono,monospace;font-size:1rem;font-weight:700;min-width:40px;text-align:center;}
.card.r{color:var(--red);}.card.b{color:var(--text);}
.bjas{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;}
.bja{flex:1;padding:10px;border-radius:8px;border:1px solid var(--border);background:#0a1018;color:var(--text);cursor:pointer;font-weight:600;font-size:.85rem;transition:.15s;}
.bja:hover{border-color:var(--green);color:var(--green);}
.bja:disabled{opacity:.4;cursor:not-allowed;}
.bb{width:100%;padding:14px;background:var(--green);color:#000;border:none;border-radius:10px;font-weight:700;font-size:1rem;cursor:pointer;letter-spacing:.5px;transition:all .2s;margin-top:8px;}
.bb:hover{background:var(--green2);}
.bb:disabled{opacity:.5;cursor:not-allowed;}
.rb2{border-radius:10px;padding:16px;margin-top:14px;text-align:center;display:none;}
.rb2.w{background:rgba(168,255,62,.1);border:1px solid rgba(168,255,62,.3);}
.rb2.l{background:rgba(255,77,109,.1);border:1px solid rgba(255,77,109,.3);}
.rt{font-size:1.3rem;font-weight:700;margin-bottom:4px;}.rt.w{color:var(--green);}.rt.l{color:var(--red);}
.rd{font-size:.82rem;color:var(--muted);}
.rtx{font-family:JetBrains Mono,monospace;font-size:.7rem;color:var(--blue);margin-top:6px;word-break:break-all;cursor:pointer;}
.dep{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:24px;margin-bottom:16px;display:none;}
.dst{display:flex;flex-direction:column;gap:12px;margin-bottom:16px;}
.ds{display:flex;gap:12px;}
.dn{width:24px;height:24px;border-radius:50%;background:var(--green);color:#000;font-size:.75rem;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px;}
.dt{font-size:.85rem;color:var(--muted);}.dt strong{color:var(--text);}
.ta{font-family:JetBrains Mono,monospace;font-size:.72rem;background:#0a1018;padding:8px 12px;border-radius:6px;border:1px solid var(--border);margin-top:6px;word-break:break-all;color:var(--blue);}
.mo{position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px;}
.mb{background:var(--card);border:1px solid var(--green);border-radius:16px;padding:28px;width:100%;max-width:420px;animation:fu .2s ease;}
@keyframes fu{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
.mb h3{font-size:1.1rem;font-weight:700;color:var(--green);margin-bottom:6px;letter-spacing:1px;}
.mb p{font-size:.82rem;color:var(--muted);margin-bottom:16px;}
.mb input{margin-bottom:10px;}
.mbtn{width:100%;padding:13px;background:var(--green);color:#000;border:none;border-radius:10px;font-weight:700;font-size:.95rem;cursor:pointer;}
.mcan{width:100%;margin-top:8px;padding:10px;background:none;border:1px solid var(--border);border-radius:8px;color:var(--muted);cursor:pointer;font-size:.85rem;}
.mcan:hover{border-color:var(--red);color:var(--red);}
.merr{color:var(--red);font-size:.78rem;min-height:18px;margin-top:4px;}
.tw{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:9999;display:flex;flex-direction:column;gap:8px;align-items:center;}
.t{background:#111827;border:1px solid var(--border);padding:10px 20px;border-radius:24px;font-size:.85rem;animation:su .25s ease;white-space:nowrap;max-width:90vw;overflow:hidden;text-overflow:ellipsis;}
.t.s{border-color:var(--green);color:var(--green);}.t.e{border-color:var(--red);color:var(--red);}.t.i{border-color:var(--blue);color:var(--blue);}
@keyframes su{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
@keyframes sp{to{transform:rotate(360deg);}}
.spin{width:16px;height:16px;border:2px solid rgba(0,0,0,.3);border-top-color:#000;border-radius:50%;animation:sp .6s linear infinite;display:inline-block;vertical-align:middle;margin-right:6px;}
.foot{background:rgba(6,10,15,.95);border-top:1px solid var(--border);padding:16px 20px;text-align:center;margin-top:40px;}
.foot p{font-size:.75rem;color:var(--muted);}
.foot a{color:var(--green);text-decoration:none;}
</style>
</head>
<body>
<nav>
  <div class="logo">XERIS<span>.PLAY</span></div>
  <div class="nav-right">
    <div id="balDisp">0.0000 XRS</div>
    <button id="conBtn" onclick="openWM()">üîó Connect Wallet</button>
  </div>
</nav>
<div class="hero">
  <div class="badge">POWERED BY XERIS BLOCKCHAIN</div>
  <h1>Play Fair.<br><span>Win Big.</span><br>On-Chain.</h1>
  <p>Provably fair casino games with real XRS. Every bet on-chain.</p>
  <div class="stats">
    <div><div class="stat-v" id="sG">‚Äî</div><div class="stat-l">GAMES PLAYED</div></div>
    <div><div class="stat-v" id="sT">‚Äî</div><div class="stat-l">TREASURY XRS</div></div>
    <div><div class="stat-v">0%</div><div class="stat-l">HOUSE EDGE</div></div>
  </div>
</div>
<div class="sec">
  <div id="depPanel" class="dep">
    <div class="ph"><span class="pt">üí∞ Deposit XRS</span><button class="cb" onclick="document.getElementById('depPanel').style.display='none'">‚úï Close</button></div>
    <div class="dst">
      <div class="ds"><div class="dn">1</div><div class="dt"><strong>Copy treasury address</strong><div class="ta" id="tAddr">Loading...</div></div></div>
      <div class="ds"><div class="dn">2</div><div class="dt"><strong>Send XRS</strong> from your wallet to the address above</div></div>
      <div class="ds"><div class="dn">3</div><div class="dt"><strong>Paste the transaction signature</strong> below to credit your balance</div></div>
    </div>
    <div class="ir">
      <div class="ig"><label class="il">TX SIGNATURE</label><input id="dTx" placeholder="Paste tx signature..."/></div>
      <div class="ig" style="max-width:130px"><label class="il">AMOUNT (XRS)</label><input id="dAmt" type="number" placeholder="10" min="1"/></div>
    </div>
    <button class="bb" onclick="doDeposit()">CONFIRM DEPOSIT</button>
    <div id="dRes" style="margin-top:10px;"></div>
  </div>
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px;">
    <span class="sec-t" style="margin-bottom:0">Choose a game</span>
    <button id="depBtn" style="display:none;background:var(--green);color:#000;border:none;padding:7px 14px;border-radius:7px;font-weight:700;font-size:.8rem;cursor:pointer;" onclick="document.getElementById('depPanel').style.display='block';document.getElementById('depPanel').scrollIntoView({behavior:'smooth'})">+ DEPOSIT XRS</button>
  </div>
  <div class="grid">
    <div class="gc" id="gc-crash" onclick="selGame('crash')"><div class="gi">üöÄ</div><div class="gn">CRASH</div><div class="gd">Up to 1000√ó</div></div>
    <div class="gc" id="gc-dice" onclick="selGame('dice')"><div class="gi">üé≤</div><div class="gn">DICE</div><div class="gd">Over, under, exact</div></div>
    <div class="gc" id="gc-roulette" onclick="selGame('roulette')"><div class="gi">üé°</div><div class="gn">ROULETTE</div><div class="gd">35√ó straight-up</div></div>
    <div class="gc" id="gc-blackjack" onclick="selGame('blackjack')"><div class="gi">üÉè</div><div class="gn">BLACKJACK</div><div class="gd">3:2 natural BJ</div></div>
  </div>
  <div id="gPanel">
    <div class="ph"><span class="pt" id="gTitle">Game</span><button class="cb" onclick="document.getElementById('gPanel').style.display='none';document.querySelectorAll('.gc').forEach(c=>c.classList.remove('on'))">‚úï Close</button></div>
    <div id="g-crash" style="display:none">
      <div class="cdisp"><div class="cm" id="cM">1.00√ó</div><div class="cl" id="cL">PLACE BET TO PLAY</div></div>
      <div class="ch" id="cH"></div>
      <div class="ir">
        <div class="ig"><label class="il">BET (XRS)</label><input id="cA" type="number" placeholder="10" min="1" oninput="updCP()"/></div>
        <div class="ig"><label class="il">AUTO CASHOUT AT</label><input id="cT" type="number" placeholder="2.00" step="0.1" min="1.1" oninput="updCP()"/></div>
      </div>
      <div class="qa-row">
        <span class="qa" onclick="sa('cA',5)">5</span><span class="qa" onclick="sa('cA',10)">10</span><span class="qa" onclick="sa('cA',25)">25</span><span class="qa" onclick="sa('cA',50)">50</span>
        <span style="margin-left:auto;font-size:.75rem;color:var(--muted)">Win: <b id="cP" style="color:var(--green)">‚Äî</b></span>
      </div>
    </div>
    <div id="g-dice" style="display:none">
      <div class="ddisp">
        <div class="dr" id="dR">?</div>
        <div><div id="dRng" style="font-size:.8rem;color:var(--muted)">Roll over 50</div><div id="dPay" style="font-size:.9rem;color:var(--green);margin-top:4px;font-weight:600">49% ¬∑ 1.96√ó</div></div>
      </div>
      <div class="ir">
        <div class="ig"><label class="il">TYPE</label><select id="dT" onchange="updD()"><option value="over">Over</option><option value="under">Under</option><option value="exact">Exact</option></select></div>
        <div class="ig"><label class="il">NUMBER (1-100)</label><input id="dV" type="number" placeholder="50" min="1" max="100" oninput="updD()"/></div>
        <div class="ig"><label class="il">BET (XRS)</label><input id="dA" type="number" placeholder="10" min="1"/></div>
      </div>
      <div class="qa-row"><span class="qa" onclick="sa('dA',5)">5</span><span class="qa" onclick="sa('dA',10)">10</span><span class="qa" onclick="sa('dA',25)">25</span><span class="qa" onclick="sa('dA',50)">50</span></div>
    </div>
    <div id="g-roulette" style="display:none">
      <div class="rdisp"><div class="rr" id="rR">?</div><div style="font-size:.75rem;color:var(--muted);margin-top:4px" id="rC">Spin to play</div></div>
      <div class="rbets">
        <div class="rb on" id="rb-red" onclick="selRB('red')"><div class="rbn" style="color:var(--red)">üî¥ Red</div><div class="rbo">2√ó</div></div>
        <div class="rb" id="rb-black" onclick="selRB('black')"><div class="rbn">‚ö´ Black</div><div class="rbo">2√ó</div></div>
        <div class="rb" id="rb-green" onclick="selRB('green')"><div class="rbn" style="color:var(--green)">üü¢ Green</div><div class="rbo">14√ó</div></div>
        <div class="rb" id="rb-even" onclick="selRB('even')"><div class="rbn">Even</div><div class="rbo">2√ó</div></div>
        <div class="rb" id="rb-odd" onclick="selRB('odd')"><div class="rbn">Odd</div><div class="rbo">2√ó</div></div>
        <div class="rb" id="rb-number" onclick="selRB('number')"><div class="rbn">Straight</div><div class="rbo">35√ó</div></div>
      </div>
      <div class="ir" id="rNR" style="display:none"><div class="ig"><label class="il">NUMBER (0-36)</label><input id="rN" type="number" placeholder="7" min="0" max="36"/></div></div>
      <div class="ir"><div class="ig"><label class="il">BET (XRS)</label><input id="rA" type="number" placeholder="10" min="1"/></div></div>
      <div class="qa-row"><span class="qa" onclick="sa('rA',5)">5</span><span class="qa" onclick="sa('rA',10)">10</span><span class="qa" onclick="sa('rA',25)">25</span><span class="qa" onclick="sa('rA',50)">50</span></div>
    </div>
    <div id="g-blackjack" style="display:none">
      <div class="bjt">
        <div class="bjhl">DEALER</div><div class="cards" id="dC"></div><div id="dS" style="font-size:.8rem;color:var(--muted);margin-bottom:12px"></div>
        <div class="bjhl">YOUR HAND</div><div class="cards" id="pC"></div><div id="pS" style="font-size:.8rem;color:var(--muted)"></div>
      </div>
      <div class="bjas" id="bjA" style="display:none">
        <button class="bja" onclick="bjAct('hit')">Hit</button>
        <button class="bja" onclick="bjAct('stand')">Stand</button>
        <button class="bja" onclick="bjAct('double')">Double</button>
      </div>
      <div class="ir" id="bjBR"><div class="ig"><label class="il">BET (XRS)</label><input id="bjA2" type="number" placeholder="10" min="1"/></div></div>
      <div class="qa-row" id="bjQR"><span class="qa" onclick="sa('bjA2',5)">5</span><span class="qa" onclick="sa('bjA2',10)">10</span><span class="qa" onclick="sa('bjA2',25)">25</span><span class="qa" onclick="sa('bjA2',50)">50</span></div>
    </div>
    <button class="bb" id="betBtn" onclick="placeBet()">PLACE BET</button>
    <div class="rb2" id="resBox">
      <div class="rt" id="resT"></div>
      <div class="rd" id="resD"></div>
      <div class="rtx" id="resTx" onclick="openTx()"></div>
    </div>
  </div>
</div>
<div class="tw" id="tw"></div>
<div class="mo" id="wModal" style="display:none" onclick="if(event.target===this)closeWM()">
  <div class="mb">
    <h3>üîó CONNECT XRS WALLET</h3>
    <p>Paste your XRS wallet address below, or open in Xeris Wallet Browser for auto-connect.</p>
    <input id="wAddr" type="text" placeholder="XRS wallet address..." autocomplete="off"/>
    <div class="merr" id="wErr"></div>
    <button class="mbtn" onclick="confirmW()">CONNECT</button>
    <button class="mcan" onclick="closeWM()">Cancel</button>
    <p style="text-align:center;font-size:.75rem;color:var(--muted);margin-top:12px">No wallet? <a href="https://xerisweb.com" target="_blank" style="color:var(--green)">Get Xeris Wallet ‚Üí</a></p>
  </div>
</div>
<div class="foot"><p>¬© 2026 XERIS.PLAY ¬∑ Provably Fair ¬∑ <a href="#">Xeris Blockchain</a> ¬∑ 0% House Edge</p></div>
<script src="/js/xeris-tx.js"></script>
<script>
const S={addr:null,bal:0,game:null,rbet:'red',lastTx:null,bjState:null};
window.addEventListener('load',async()=>{
  loadStats();loadTreasury();
  if(window.xeris&&window.XerisTx){try{const a=await XerisTx.silentConnect();if(a)await onConn(a);}catch(e){}}
});
async function loadStats(){try{const r=await fetch('/api/stats');const d=await r.json();if(d.gamesPlayed!=null)document.getElementById('sG').textContent=d.gamesPlayed.toLocaleString();}catch(e){}}
async function loadTreasury(){try{const r=await fetch('/api/treasury');const d=await r.json();if(d.balance!=null)document.getElementById('sT').textContent=(d.balance/1e9).toFixed(2)+' XRS';if(d.address)document.getElementById('tAddr').textContent=d.address;}catch(e){document.getElementById('tAddr').textContent='Unavailable';}}
function openWM(){
  if(window.xeris&&window.XerisTx){XerisTx.connectWallet().then(a=>onConn(a)).catch(()=>{document.getElementById('wModal').style.display='flex';});return;}
  document.getElementById('wModal').style.display='flex';
  setTimeout(()=>document.getElementById('wAddr').focus(),100);
}
function closeWM(){document.getElementById('wModal').style.display='none';document.getElementById('wErr').textContent='';}
async function confirmW(){
  const a=document.getElementById('wAddr').value.trim();
  if(async function executePayout(rd, w){||a.length<20){document.getElementById('wErr').textContent='Enter a valid XRS address';return;}  closeWM();await onConn(a);
}
async function onConn(address){
  S.addr=address;localStorage.setItem('xrs_addr',address);
  const s=address.slice(0,6)+'...'+address.slice(-4);
  document.getElementById('conBtn').textContent=s;document.getElementById('conBtn').classList.add('on');
  document.getElementById('balDisp').style.display='block';
  document.getElementById('depBtn').style.display='block';
  await refBal();toast('Wallet connected','s');
  if(window.xeris&&window.xeris.on)window.xeris.on('disconnect',()=>{S.addr=null;localStorage.removeItem('xrs_addr');document.getElementById('conBtn').textContent='Connect Wallet';document.getElementById('conBtn').classList.remove('on');document.getElementById('balDisp').style.display='none';});
}
async function refBal(){
  try{const r=await fetch('/api/balance/'+S.addr);const d=await r.json();S.bal=d.balance||0;document.getElementById('balDisp').textContent=S.bal.toFixed(4)+' XRS';}catch(e){}
}
function selGame(g){
  document.querySelectorAll('.gc').forEach(c=>c.classList.remove('on'));
  document.getElementById('gc-'+g).classList.add('on');
  S.game=g;
  document.getElementById('gPanel').style.display='block';
  ['crash','dice','roulette','blackjack'].forEach(x=>document.getElementById('g-'+x).style.display='none');
  document.getElementById('g-'+g).style.display='block';
  hideRes();
  const lbl={crash:'üöÄ PLACE BET',dice:'üé≤ ROLL DICE',roulette:'üé° SPIN',blackjack:'üÉè DEAL'};
  document.getElementById('betBtn').textContent=lbl[g]||'PLACE BET';
  document.getElementById('betBtn').style.display='block';
  document.getElementById('bjA').style.display='none';
  document.getElementById('bjBR').style.display='flex';
  document.getElementById('bjQR').style.display='flex';
  const titles={crash:'üöÄ Crash',dice:'üé≤ Dice',roulette:'üé° Roulette',blackjack:'üÉè Blackjack'};
  document.getElementById('gTitle').textContent=titles[g];
  setTimeout(()=>document.getElementById('gPanel').scrollIntoView({behavior:'smooth',block:'start'}),100);
}
async function placeBet(){
  const g=S.game;if(grep -n app.|router.|POST|GET ~/xeris-play/server.js | grep -v // | head -40)return;  let amount,betType,betValue;
  if(g==='crash'){amount=parseFloat(document.getElementById('cA').value);betType='auto';betValue=document.getElementById('cT').value||'2.00';}
  else if(g==='dice'){amount=parseFloat(document.getElementById('dA').value);betType=document.getElementById('dT').value;betValue=document.getElementById('dV').value||'50';}
  else if(g==='roulette'){amount=parseFloat(document.getElementById('rA').value);betType=S.rbet;betValue=S.rbet==='number'?(document.getElementById('rN').value||'7'):S.rbet;}
  else if(g==='blackjack'){amount=parseFloat(document.getElementById('bjA2').value);betType='deal';betValue='0';}
  if(amount>S.bal){toast('Insufficient balance ‚Äî deposit XRS first','e');document.getElementById('depPanel').style.display='block';document.getElementById('depPanel').scrollIntoView({behavior:'smooth'});return;}
  setBL(true);hideRes();
  try{
    let sig='';
    const ta=document.getElementById('tAddr').textContent.trim();
    if(window.xeris&&window.XerisTx&&ta&&ta.length>20){
      toast('Sign bet in wallet...','i');
      try{const r=await XerisTx.sendXRS(S.addr,ta,amount);sig=r.signature||'';}catch(e){console.warn('On-chain bet failed:',e.message);}
    }
    toast('Placing bet...','i');
    const r=await fetch('/api/bet',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({game:g,betType,betValue:String(betValue),amount,playerAddress:S.addr,betTxSignature:sig||('demo_'+Date.now()),username:S.addr.slice(0,6)+'...'})});
    const d=await r.json();
    handleRes(g,d);await refBal();
  }catch(e){toast(e.message||'Bet failed','e');showRes(false,'Error',e.message,null);}
  setBL(false);
}
function handleRes(g,d){
  const won=d.payout>0;S.lastTx=d.payoutTxSignature||d.betTxSignature||null;
  if(g==='crash'){const cp=(d.result?.crashPoint||0).toFixed(2);document.getElementById('cM').textContent=cp+'x';document.getElementById('cM').className='cm '+(won?'win':'crash');document.getElementById('cL').textContent=won?'CASHED OUT!':'CRASHED';addCH(parseFloat(cp));showRes(won,won?'üöÄ WIN! +'+d.payoutAmount+' XRS':'üí• Crashed at '+cp+'x','Bet: '+d.betAmount+' XRS',d.payoutTxSignature);}
  else if(g==='dice'){const roll=d.result?.roll??'?';document.getElementById('dR').textContent=roll;showRes(won,won?'üé≤ WIN! +'+d.payoutAmount+' XRS':'üé≤ Rolled '+roll,'Target: '+document.getElementById('dT').value+' '+document.getElementById('dV').value,d.payoutTxSignature);}
  else if(g==='roulette'){const n=d.result?.number??'?';const c=d.result?.color||'black';const el=document.getElementById('rR');el.textContent=n;el.className='rr '+c;document.getElementById('rC').textContent=c.toUpperCase()+(n%2===0?' ¬∑ EVEN':' ¬∑ ODD');showRes(won,won?'üé° WIN! +'+d.payoutAmount+' XRS':'üé° '+c.toUpperCase()+' '+n,'Bet on '+S.rbet,d.payoutTxSignature);}
  else if(g==='blackjack'){renderBJ(d);}
}
function renderBJ(d){
  S.bjState=d;const res=d.result||{};const ph=res.playerHand||[];const dh=res.dealerHand||[];const over=res.status!=='playing';
  document.getElementById('pS').textContent='Score: '+(res.playerScore||hVal(ph));
  document.getElementById('dS').textContent=over?'Score: '+(res.dealerScore||hVal(dh)):'Score: ?';
  document.getElementById('bjBR').style.display=over?'flex':'none';
  document.getElementById('bjQR').style.display=over?'flex':'none';
  document.getElementById('betBtn').style.display=over?'block':'none';
  document.getElementById('bjA').style.display=over?'none':'flex';
  if(over){const won=d.payout>0;showRes(won,won?'üÉè WIN! +'+d.payoutAmount+' XRS':'üÉè '+(res.status||'Dealer wins'),'Bet: '+d.betAmount+' XRS',d.payoutTxSignature);}
}
function renderCards(id,hand,hideSecond){
  const suits={H:'‚ô•',D:'‚ô¶',C:'‚ô£',S:'‚ô†'};
  el.innerHTML=hand.map((c,i)=>{if(hideSecond&&i===1)return'<div class="card b" style="filter:blur(3px)">?</div>';const v=c.slice(0,-1),s=c.slice(-1),sym=suits[s]||s,red=s==='H'||s==='D';return'<div class="card '+(red?'r':'b')+'">'+v+sym+'</div>';}).join('');
}
async function bjAct(action){
  setBL(true);
  setBL(false);
}
async function doDeposit(){
  const tx=document.getElementById('dTx').value.trim();const amt=parseFloat(document.getElementById('dAmt').value);
  const btn=document.querySelector('#depPanel .bb');btn.disabled=true;btn.textContent='Confirming...';
  S.bal=d.newBalance||S.bal+amt*0.98;document.getElementById('balDisp').textContent=S.bal.toFixed(4)+' XRS';
  document.getElementById('dRes').innerHTML='<div style="color:var(--green);margin-top:8px;font-weight:600">‚úì +'+d.credited+' XRS credited</div>';
  document.getElementById('dTx').value='';toast('Deposit confirmed!','s');}
  catch(e){toast(e.message||'Deposit failed','e');}
  btn.disabled=false;btn.textContent='CONFIRM DEPOSIT';
}
function setBL(on){const b=document.getElementById('betBtn');b.disabled=on;b.innerHTML=on?'<span class="spin"></span>Processing...':{crash:'üöÄ PLACE BET',dice:'üé≤ ROLL DICE',roulette:'üé° SPIN',blackjack:'üÉè DEAL'}[S.game]||'PLACE BET';if(on)b.style.background='var(--muted)';else b.style.background='';}
function showRes(won,title,detail,tx){const b=document.getElementById('resBox');b.style.display='block';b.className='rb2 '+(won?'w':'l');const t=document.getElementById('resT');t.textContent=title;t.className='rt '+(won?'w':'l');document.getElementById('resD').textContent=detail||'';const te=document.getElementById('resTx');if(tx){te.textContent='Tx: '+tx.slice(0,24)+'...';S.lastTx=tx;}else te.textContent='';}
function hideRes(){document.getElementById('resBox').style.display='none';}
function openTx(){if(S.lastTx)window.open('https://explorer.xerisweb.com/v2/tx/'+S.lastTx,'_blank');}
function sa(id,v){document.getElementById(id).value=v;if(id==='cA')updCP();}
function updCP(){const a=parseFloat(document.getElementById('cA').value)||0;const t=parseFloat(document.getElementById('cT').value)||2;document.getElementById('cP').textContent=a?(a*t).toFixed(2)+' XRS':'‚Äî';}
function updD(){const t=document.getElementById('dT').value;const v=parseInt(document.getElementById('dV').value)||50;let c,p;if(t==='exact'){c=1;p=99;}else if(t==='over'){c=100-v;p=(99/(100-v)).toFixed(2);}else{c=v-1;p=(99/(v-1)).toFixed(2);}document.getElementById('dRng').textContent='Roll '+t+' '+v;document.getElementById('dPay').textContent=c+'% ¬∑ '+p+'x';}
function selRB(t){S.rbet=t;document.querySelectorAll('.rb').forEach(b=>b.classList.remove('on'));document.getElementById('rb-'+t).classList.add('on');document.getElementById('rNR').style.display=t==='number'?'flex':'none';}
function addCH(v){const h=document.getElementById('cH');const s=document.createElement('span');s.className='chi '+(v<2?'lo':v<10?'mi':'hi');s.textContent=v.toFixed(2)+'x';h.insertBefore(s,h.firstChild);if(h.children.length>10)h.removeChild(h.lastChild);}
function toast(msg,type){const w=document.getElementById('tw');const t=document.createElement('div');t.className='t '+type;t.textContent=msg;w.appendChild(t);setTimeout(()=>{t.style.opacity=0;t.style.transition='opacity .3s';setTimeout(()=>t.remove(),300);},2800);}
document.getElementById('wAddr').addEventListener('keydown',e=>{if(e.key==='Enter')confirmW();});
</script>
</body>
</html>